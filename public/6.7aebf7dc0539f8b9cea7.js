(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{w8Di:function(t,e,i){"use strict";i.r(e),i.d(e,"AssistantModule",(function(){return ht}));var s=i("SVse"),n=i("iInd"),c=i("mrSG"),r=i("XNiG"),o=i("l5mm"),a=i("lJxs"),b=i("IzEk"),d=i("vkgz"),l=i("1G5W"),u=i("8Y7J"),h=i("TGE+"),k=i("qfBg"),S=i("Gyf/"),v=i("zHaW"),m=i("jMqV"),g=i("s7LF"),p=i("Tj54"),f=i("pu8Q"),R=i("zQhy");function w(t,e){1&t&&(u.Sb(0,"div",12),u.Nb(1,"mat-spinner"),u.Rb())}function y(t,e){1&t&&(u.Sb(0,"span"),u.Sb(1,"mat-icon",31),u.wc(2,"directions_walk"),u.Rb(),u.Rb())}function T(t,e){if(1&t&&(u.Sb(0,"div"),u.Sb(1,"div"),u.wc(2," Atendiendo turno "),u.Rb(),u.Sb(3,"div",32),u.Sb(4,"div",33),u.wc(5),u.Rb(),u.Rb(),u.Rb()),2&t){const t=u.dc(2);u.Ab(5),u.zc(" ",null==t.ticketsService.myTicket.id_skill?null:t.ticketsService.myTicket.id_skill.cd_skill," ",t.ticketsService.myTicket.id_position," ")}}function _(t,e){if(1&t&&(u.Sb(0,"div",34),u.wc(1),u.Rb()),2&t){const t=u.dc(2);u.Ab(1),u.xc(t.message)}}const A=function(){return["/admin/assistants"]};function I(t,e){1&t&&(u.Sb(0,"div",35),u.Sb(1,"p"),u.wc(2," Usted no tiene habilidades asignadas. Debe ir al administrador de asistentes, luego seleccionar el asistente y all\xed asignarle skills / habilidades. "),u.Sb(3,"button",36),u.wc(4,"ADMINISTRADOR DE ASISTENTES"),u.Rb(),u.Rb(),u.Rb()),2&t&&(u.Ab(3),u.jc("routerLink",u.lc(1,A)))}function x(t,e){1&t&&(u.Sb(0,"span",41),u.Sb(1,"mat-icon"),u.wc(2,"check"),u.Rb(),u.Rb())}function j(t,e){if(1&t&&(u.Sb(0,"span"),u.Nb(1,"mat-radio-button",42),u.Rb()),2&t){const t=u.dc().$implicit;u.Ab(1),u.jc("value",t.id)}}function C(t,e){if(1&t&&(u.Sb(0,"tr"),u.Sb(1,"td",37),u.vc(2,x,3,0,"span",38),u.vc(3,j,2,1,"span",16),u.Rb(),u.Sb(4,"td",39),u.wc(5),u.Rb(),u.Sb(6,"td",40),u.wc(7),u.Rb(),u.Rb()),2&t){const t=e.$implicit,i=u.dc(2);u.Ab(2),u.jc("ngIf",t.assigned),u.Ab(1),u.jc("ngIf",!t.assigned&&!i.waitForClient&&i.ticketsService.myTicket),u.Ab(2),u.yc(" ",t.tx_skill," "),u.Ab(2),u.yc(" ",t.tickets.length," ")}}function D(t,e){if(1&t){const t=u.Tb();u.Sb(0,"div",13),u.Sb(1,"div",14),u.Sb(2,"div",15),u.Sb(3,"span"),u.wc(4),u.Rb(),u.vc(5,y,3,0,"span",16),u.Rb(),u.Sb(6,"div",17),u.Sb(7,"div",18),u.vc(8,T,6,2,"div",16),u.vc(9,_,2,1,"div",19),u.Rb(),u.Rb(),u.Sb(10,"div",20),u.Sb(11,"div",4),u.Sb(12,"div",21),u.Sb(13,"div"),u.wc(14,"TE"),u.Rb(),u.Sb(15,"div"),u.wc(16),u.Rb(),u.Rb(),u.Sb(17,"div",21),u.Sb(18,"div"),u.wc(19,"TA"),u.Rb(),u.Sb(20,"div"),u.wc(21),u.Rb(),u.Rb(),u.Sb(22,"div",21),u.Sb(23,"div"),u.wc(24,"Tm"),u.Rb(),u.Sb(25,"div"),u.wc(26),u.Rb(),u.Rb(),u.Sb(27,"div",21),u.Sb(28,"div"),u.wc(29,"TC"),u.Rb(),u.Sb(30,"div"),u.wc(31),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.vc(32,I,5,2,"div",22),u.Sb(33,"div",23),u.Sb(34,"div",24),u.Sb(35,"mat-radio-group",25),u.Zb("ngModelChange",(function(e){return u.pc(t),u.dc().skillSelected=e})),u.Sb(36,"table",26),u.Sb(37,"tr",27),u.Nb(38,"td",28),u.Sb(39,"td",28),u.wc(40,"Skill"),u.Rb(),u.Sb(41,"td",29),u.wc(42," En espera "),u.Rb(),u.Rb(),u.vc(43,C,8,4,"tr",30),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb()}if(2&t){const t=u.dc();u.Ab(4),u.yc(" ESCRITORIO ",null==t.userService.desktop?null:t.userService.desktop.cd_desktop," "),u.Ab(1),u.jc("ngIf",t.comingClient),u.Ab(3),u.jc("ngIf",t.ticketsService.myTicket),u.Ab(1),u.jc("ngIf",t.message),u.Ab(7),u.xc(t.tmWaitingStr),u.Ab(5),u.xc(t.tmAttention),u.Ab(5),u.xc(t.timerCount),u.Ab(5),u.xc(t.pendingTicketsCount),u.Ab(1),u.jc("ngIf",0===t.skillsAssistantThisCompany.length),u.Ab(3),u.jc("ngModel",t.skillSelected),u.Ab(8),u.jc("ngForOf",t.pendingTicketsBySkill)}}const F=function(t){return{"button-disabled":t}};let O=(()=>{class t{constructor(t,e,i,s,n){this.ticketsService=t,this.userService=e,this.wsService=i,this.snack=s,this.router=n,this.loading=!1,this.waitForClient=!1,this.comingClient=!1,this.pendingTicketsCount=0,this.pendingTicketsBySkill=[],this.timerCount=2,this.tmWaitingStr="--:--:--",this.tmAttention="--:--:--",this.message="",this.skills=[],this.skillsAssistantThisCompany=[],this.skillSelected="",this.blPriority=!1,this.subjectUpdateTickets$=new r.a,this.subjectTurnoCancelado$=new r.a}ngOnInit(){return Object(c.a)(this,void 0,void 0,(function*(){this.loading=!0,this.userService.desktop||this.router.navigate(["/assistant/home"]),yield this.readSkills().then(t=>{this.skills=t}).catch(()=>{this.snack.open("Error al obtener los skills",null,{duration:2e3})}),yield this.getTickets(),this.wsService.escucharUpdateDesktops().subscribe(this.subjectUpdateTickets$),this.subjectUpdateTickets$.subscribe(()=>{this.getTickets()}),this.wsService.escucharTicketCancelled().subscribe(this.subjectTurnoCancelado$),this.subjectTurnoCancelado$.subscribe(t=>{var e;t===(null===(e=this.ticketsService.myTicket)||void 0===e?void 0:e._id)&&(this.snack.open("El turno fue cancelado por el cliente",null,{duration:1e4}),this.clearDesktopSession(),this.getTickets())}),this.loading=!1}))}getTickets(){return Object(c.a)(this,void 0,void 0,(function*(){return this.ticketsService.getTickets().then(t=>{const e=t.filter(t=>t.id_session===this.userService.desktop.id_session._id&&null===t.tm_end&&null===t.id_child)[0];e&&(this.message="Existe un ticket pendiente de resoluci\xf3n",this.ticketsService.myTicket=e,localStorage.setItem("ticket",JSON.stringify(e)));let i=this.skills,s=[];this.userService.user.id_skills.forEach(t=>s.push(t._id));const n=t.filter(t=>{var e;return null===t.tm_end&&null===t.id_child&&s.includes(null===(e=t.id_skill)||void 0===e?void 0:e._id)}),c=t.filter(t=>null===t.tm_end&&null===t.id_child);this.pendingTicketsCount=n.length,this.message=n.length>0?`Hay ${n.length} tickets en espera`:"No existen tickets pendientes.",this.pendingTicketsBySkill=[];for(let r of i)s.includes(r._id)&&this.skillsAssistantThisCompany.push(r),this.pendingTicketsBySkill.push({id:r._id,assigned:s.includes(r._id),cd_skill:r.cd_skill,tx_skill:r.tx_skill,tickets:c.filter(t=>{var e;return(null===(e=t.id_skill)||void 0===e?void 0:e._id)===r._id&&null===t.tm_end})});this.loading=!1}).catch(()=>{this.loading=!1,this.message="Error al obtener los tickets"})}))}clearDesktopSession(){this.ticketsService.myTicket=null,localStorage.getItem("ticket")&&localStorage.removeItem("ticket"),this.ticketsService.chatMessages=[],this.tmWaitingStr="--:--:--",this.tmAttention="--:--:--",this.timerCount=2,this.waitForClient=!1,this.tmWaitingSub&&this.tmWaitingSub.unsubscribe(),this.tmExtraTimeSub&&this.tmExtraTimeSub.unsubscribe(),this.tmRunSub&&this.tmRunSub.unsubscribe(),this.getTickets()}releaseDesktop(){return Object(c.a)(this,void 0,void 0,(function*(){if(this.ticketsService.myTicket){let t="Tiene una sesi\xf3n de turno activa. \xbfDesea finalizarla?";return yield this.askForContinue(t).then(()=>{this.ticketsService.endTicket(this.ticketsService.myTicket._id).subscribe(t=>{t.ok&&this.userService.releaseDesktop(this.userService.desktop._id).subscribe(e=>{e.ok?this.router.navigate(["assistant/home"]):this.message=t.msg})})}).catch(()=>{})}this.userService.releaseDesktop(this.userService.desktop._id).subscribe(t=>{t.ok&&(this.clearDesktopSession(),this.router.navigate(["assistant/home"]))})}))}readSkills(){return new Promise((t,e)=>{var i;let s=null===(i=this.userService.user.id_company)||void 0===i?void 0:i._id;this.userService.readSkills(s).subscribe(i=>{i.ok?t(i.skills):e([])})})}askForContinue(t){return new Promise((e,i)=>{this.snack.open(t,"ACEPTAR",{duration:5e3}).afterDismissed().subscribe(t=>{t.dismissedByAction?e():i()})})}takeTicket(){return Object(c.a)(this,void 0,void 0,(function*(){if(this.ticketsService.myTicket){let t="Desea finalizar el ticket actual?";return yield this.askForContinue(t).then(()=>{this.ticketsService.endTicket(this.ticketsService.myTicket._id).subscribe(t=>{t.ok&&(this.clearDesktopSession(),this.message=t.msg)})}).catch(()=>{})}this.ticketsService.takeTicket(this.userService.desktop.id_session._id,this.wsService.idSocket).subscribe(t=>{if(this.snack.open(t.msg,null,{duration:2e3}),t.ok){this.waitForClient=!0,this.message="",this.ticketsService.myTicket=t.ticket,localStorage.setItem("ticket",JSON.stringify(t.ticket)),this.tmWaitingStr=this.ticketsService.getTimeInterval(t.ticket.tm_start,t.ticket.tm_att);const e=this.wsService.escucharEnCamino(),i=Object(o.a)(1e3).pipe(Object(a.a)(t=>t+1),Object(b.a)(2));let s=!1;this.tmWaitingSub=i.pipe(Object(d.a)(t=>this.timerCount=2-t),Object(l.a)(e)).subscribe(t=>{t>=1&&(s=!0)},void 0,()=>{new Promise(t=>{if(s)this.waitForClient=!1,this.comingClient=!1,t();else{this.waitForClient=!0,this.comingClient=!0;const e=Object(o.a)(1e3).pipe(Object(a.a)(t=>t+1),Object(b.a)(5));this.tmExtraTimeSub=e.subscribe(t=>this.timerCount=5-t,void 0,()=>{this.waitForClient=!1,this.comingClient=!1,t()})}}).then(()=>{const t=Object(o.a)(1e3),e=(new Date).getTime();this.tmRunSub=t.subscribe(t=>{this.tmAttention=this.ticketsService.getTimeInterval(e,+new Date)})})})}else this.waitForClient=!1,this.message=t.msg}),this.getTickets()}))}releaseTicket(){return Object(c.a)(this,void 0,void 0,(function*(){if(this.ticketsService.myTicket){let t="Desea soltar el ticket y devolverlo a su estado anterior?";yield this.askForContinue(t).then(()=>{this.ticketsService.releaseTicket(this.ticketsService.myTicket._id).subscribe(t=>{t.ok&&(this.clearDesktopSession(),this.message=t.msg)})}).catch(()=>{})}}))}reassignTicket(){return Object(c.a)(this,void 0,void 0,(function*(){if(this.ticketsService.myTicket){let t="Desea enviar el ticket al skill seleccionado?";yield this.askForContinue(t).then(()=>{var t;let e=null===(t=this.ticketsService.myTicket)||void 0===t?void 0:t._id,i=this.skillSelected;e&&i&&this.ticketsService.reassignTicket(e,i,this.blPriority).subscribe(t=>{t.ok&&(this.blPriority=!1,this.clearDesktopSession(),this.message=t.msg)})}).catch(()=>{})}}))}endTicket(){return Object(c.a)(this,void 0,void 0,(function*(){if(this.ticketsService.myTicket){let t="Desea finalizar el ticket actual?";yield this.askForContinue(t).then(()=>{this.ticketsService.endTicket(this.ticketsService.myTicket._id).subscribe(t=>{t.ok&&(this.clearDesktopSession(),this.message=t.msg)})}).catch(()=>{})}}))}ngOnDestroy(){this.subjectUpdateTickets$.complete(),this.subjectTurnoCancelado$.complete()}}return t.\u0275fac=function(e){return new(e||t)(u.Mb(h.a),u.Mb(k.a),u.Mb(S.a),u.Mb(v.a),u.Mb(n.b))},t.\u0275cmp=u.Gb({type:t,selectors:[["app-desktop"]],decls:44,vars:24,consts:[[1,"saturno-container","shadow-box","animated","fadeIn",2,"padding-bottom","3em"],["class","mt-5 animated fadeIn",4,"ngIf"],["class","animated fadeIn",4,"ngIf"],[1,"container","bg-light","fixed-bottom","shadow-box","no-radius","text-center","py-1"],[1,"row"],[1,"col-4","col-sm-2","button-content"],[1,"mx-2","my-1",3,"ngModel","disabled","ngModelChange"],[1,"accessible-icon"],[1,"btn","btn-success","button",3,"ngClass","disabled","click"],[1,"button-inner"],[1,"btn","btn-success","button",3,"disabled","ngClass","click"],[1,"btn","btn-danger","button",3,"disabled","ngClass","click"],[1,"mt-5","animated","fadeIn"],[1,"animated","fadeIn"],[1,"card","bg-light","mb-4"],[1,"card-header","banner-title"],[4,"ngIf"],[1,"card-body"],[1,"container"],["class","card text-white my-4 p-1","style","background-color: darkcyan;",4,"ngIf"],[1,"card-footer"],[1,"col","p-0"],["class","saturno-container card bg-danger text-white p-3 mb-4",4,"ngIf"],[1,"saturno-container","card","bg-secondary","mb-4"],[1,"card-content","table-responsive-sm","p-2"],[3,"ngModel","ngModelChange"],[1,"table","table-sm","text-white","text-center"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[2,"text-align","right","border","none"],[4,"ngFor","ngForOf"],[2,"float","right","color","blueviolet","font-size","x-large"],[1,"banner-content","xxxxl"],[1,"xxxl"],[1,"card","text-white","my-4","p-1",2,"background-color","darkcyan"],[1,"saturno-container","card","bg-danger","text-white","p-3","mb-4"],[1,"btn","btn-danger","btn-block","btn-sm","my-2",3,"routerLink"],[2,"padding","0","vertical-align","middle","font-size","16px"],["style","color: greenyellow",4,"ngIf"],[2,"text-align","left"],[2,"text-align","right"],[2,"color","greenyellow"],[2,"position","relative","left","4px","top","4px",3,"value"]],template:function(t,e){1&t&&(u.Sb(0,"div",0),u.vc(1,w,2,0,"div",1),u.vc(2,D,44,11,"div",2),u.Rb(),u.Sb(3,"div",3),u.Sb(4,"div",4),u.Sb(5,"div",5),u.Sb(6,"mat-slide-toggle",6),u.Zb("ngModelChange",(function(t){return e.blPriority=t})),u.Sb(7,"mat-icon",7),u.wc(8,"accessible"),u.Rb(),u.Rb(),u.Rb(),u.Sb(9,"div",5),u.Sb(10,"button",8),u.Zb("click",(function(){return e.reassignTicket()})),u.Sb(11,"div"),u.Sb(12,"mat-icon"),u.wc(13,"rule"),u.Rb(),u.Rb(),u.Sb(14,"div",9),u.wc(15," Asignar "),u.Rb(),u.Rb(),u.Rb(),u.Sb(16,"div",5),u.Sb(17,"button",10),u.Zb("click",(function(){return e.takeTicket()})),u.Sb(18,"div"),u.Sb(19,"mat-icon"),u.wc(20,"check"),u.Rb(),u.Rb(),u.Sb(21,"div",9),u.wc(22," Siguiente "),u.Rb(),u.Rb(),u.Rb(),u.Sb(23,"div",5),u.Sb(24,"button",10),u.Zb("click",(function(){return e.releaseTicket()})),u.Sb(25,"div"),u.Sb(26,"mat-icon"),u.wc(27,"replay"),u.Rb(),u.Rb(),u.Sb(28,"div",9),u.wc(29," Soltar "),u.Rb(),u.Rb(),u.Rb(),u.Sb(30,"div",5),u.Sb(31,"button",10),u.Zb("click",(function(){return e.endTicket()})),u.Sb(32,"div"),u.Sb(33,"mat-icon"),u.wc(34,"close"),u.Rb(),u.Rb(),u.Sb(35,"div",9),u.wc(36," Finalizar "),u.Rb(),u.Rb(),u.Rb(),u.Sb(37,"div",5),u.Sb(38,"button",11),u.Zb("click",(function(){return e.releaseDesktop()})),u.Sb(39,"div"),u.Sb(40,"mat-icon"),u.wc(41,"power_settings_new"),u.Rb(),u.Rb(),u.Sb(42,"div",9),u.wc(43," Salir "),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb()),2&t&&(u.Ab(1),u.jc("ngIf",e.loading),u.Ab(1),u.jc("ngIf",!e.loading),u.Ab(4),u.jc("ngModel",e.blPriority)("disabled",e.waitForClient||!e.ticketsService.myTicket||""===e.skillSelected),u.Ab(4),u.jc("ngClass",u.mc(14,F,e.waitForClient||!e.ticketsService.myTicket||""===e.skillSelected))("disabled",e.waitForClient||!e.ticketsService.myTicket||""===e.skillSelected),u.Ab(7),u.jc("disabled",e.waitForClient)("ngClass",u.mc(16,F,e.waitForClient)),u.Ab(7),u.jc("disabled",e.waitForClient||!e.ticketsService.myTicket)("ngClass",u.mc(18,F,e.waitForClient||!e.ticketsService.myTicket)),u.Ab(7),u.jc("disabled",e.waitForClient||!e.ticketsService.myTicket)("ngClass",u.mc(20,F,e.waitForClient||!e.ticketsService.myTicket)),u.Ab(7),u.jc("disabled",e.waitForClient)("ngClass",u.mc(22,F,e.waitForClient)))},directives:[s.j,m.a,g.o,g.r,p.a,s.h,f.b,R.b,s.i,n.c,R.a],styles:[".button-disabled[_ngcontent-%COMP%]{background-color:#f1f1f1;color:#c7c7c7}"]}),t})();var M=i("AIE+"),E=i("Q2Ze"),N=i("ZTz/"),z=i("UhP/");function $(t,e){1&t&&(u.Sb(0,"div",4),u.Nb(1,"mat-spinner"),u.Rb())}function W(t,e){1&t&&(u.Sb(0,"div",8),u.wc(1," No tiene asignada ning\xfana empresa. Debe seleccionarla desde el men\xfa prinicipal. "),u.Rb())}function Z(t,e){1&t&&(u.Sb(0,"div",8),u.wc(1," No tiene escritorios creados. Debe darlos de alta desde el Men\xfa de Administrador. "),u.Rb())}function H(t,e){if(1&t){const t=u.Tb();u.Sb(0,"div",2),u.wc(1),u.Sb(2,"div"),u.Sb(3,"button",17),u.Zb("click",(function(){u.pc(t);const e=u.dc(3);return e.takeDesktop(e.myDesktop)})),u.wc(4,"Ingresar"),u.Rb(),u.Sb(5,"button",18),u.Zb("click",(function(){u.pc(t);const e=u.dc(3);return e.releaseDesktop(e.myDesktop)})),u.wc(6,"Finalizar"),u.Rb(),u.Rb(),u.Rb()}if(2&t){const t=u.dc(3);u.Ab(1),u.yc(" Usted tiene tomado el escritorio ",t.myDesktop.cd_desktop," ")}}function P(t,e){1&t&&(u.Sb(0,"div",20),u.wc(1," Todos los escritorios estan tomados. "),u.Rb())}function U(t,e){if(1&t&&(u.Sb(0,"mat-option",26),u.wc(1),u.Rb()),2&t){const t=e.$implicit;u.jc("value",t),u.Ab(1),u.yc(" ",t.cd_desktop," ")}}function J(t,e){if(1&t){const t=u.Tb();u.Sb(0,"div",2),u.Sb(1,"mat-form-field",21),u.Sb(2,"mat-label"),u.wc(3,"Seleccione un escritorio"),u.Rb(),u.Sb(4,"mat-select",22,23),u.vc(6,U,2,2,"mat-option",24),u.Rb(),u.Rb(),u.Sb(7,"button",25),u.Zb("click",(function(){u.pc(t);const e=u.oc(5);return u.dc(4).takeDesktop(null==e?null:e.value)})),u.wc(8," Ingresar "),u.Rb(),u.Rb()}if(2&t){const t=u.dc(4);u.Ab(6),u.jc("ngForOf",t.desktopsAvailable)}}function G(t,e){if(1&t&&(u.Sb(0,"div",2),u.vc(1,P,2,0,"div",19),u.vc(2,J,9,1,"div",9),u.Rb()),2&t){const t=u.dc(3);u.Ab(1),u.jc("ngIf",0===t.desktopsAvailable.length),u.Ab(1),u.jc("ngIf",t.desktopsAvailable.length>0)}}function B(t,e){if(1&t&&(u.Sb(0,"div"),u.wc(1),u.Rb()),2&t){const t=u.dc().$implicit;u.Ab(1),u.yc(" ",null==t.id_session?null:t.id_session.id_assistant.tx_name," ")}}function L(t,e){1&t&&(u.Sb(0,"div",30),u.wc(1," Disponible "),u.Rb())}function q(t,e){if(1&t&&(u.Sb(0,"tr"),u.Sb(1,"td",27),u.wc(2),u.Rb(),u.Sb(3,"td",28),u.vc(4,B,2,1,"div",7),u.vc(5,L,2,0,"div",29),u.Rb(),u.Rb()),2&t){const t=e.$implicit;u.Ab(2),u.yc(" ",t.cd_desktop," "),u.Ab(2),u.jc("ngIf",t.id_session),u.Ab(1),u.jc("ngIf",!t.id_session)}}function Q(t,e){if(1&t&&(u.Sb(0,"div"),u.vc(1,H,7,1,"div",9),u.vc(2,G,3,2,"div",9),u.Sb(3,"div",10),u.Sb(4,"div",11),u.Sb(5,"table",12),u.Sb(6,"tr",13),u.Sb(7,"td",14),u.wc(8," Escritorio "),u.Rb(),u.Sb(9,"td",15),u.wc(10," Asistente "),u.Rb(),u.Rb(),u.vc(11,q,6,3,"tr",16),u.Rb(),u.Rb(),u.Rb(),u.Rb()),2&t){const t=u.dc(2);u.Ab(1),u.jc("ngIf",t.myDesktop),u.Ab(1),u.jc("ngIf",!t.myDesktop),u.Ab(9),u.jc("ngForOf",t.desktops)}}function K(t,e){if(1&t&&(u.Sb(0,"div",4),u.Sb(1,"p",5),u.wc(2,"Bienvenido, desde aqu\xed puede tomar escritorios y atender turnos."),u.Rb(),u.vc(3,W,2,0,"div",6),u.vc(4,Z,2,0,"div",6),u.vc(5,Q,12,3,"div",7),u.Rb()),2&t){const t=u.dc();u.Ab(3),u.jc("ngIf",!t.userService.user.id_company),u.Ab(1),u.jc("ngIf",0===(null==t.desktops?null:t.desktops.length)),u.Ab(1),u.jc("ngIf",(null==t.desktops?null:t.desktops.length)>0&&(null==t.userService.user.id_company?null:t.userService.user.id_company._id))}}let V=(()=>{class t{constructor(t,e,i){this.router=t,this.userService=e,this.snack=i,this.loading=!1,this.desktops=[],this.desktopsAvailable=[]}ngOnInit(){var t;if(this.loading=!0,!(null===(t=this.userService.user.id_company)||void 0===t?void 0:t._id))return this.userService.snackShow("No tiene una empresa seleccionada",5e3),void(this.loading=!1);this.readDesktops(this.userService.user.id_company._id),this.userSuscription=this.userService.user$.subscribe(t=>{t&&this.readDesktops(t.id_company._id)})}takeDesktop(t){t&&(this.userService.desktop?this.router.navigate(["/assistant/desktop"]):this.userService.takeDesktop(t._id,this.userService.user._id).subscribe(t=>{this.snack.open(t.msg,null,{duration:2e3}),t.ok?(this.userService.desktop=t.desktop,localStorage.setItem("desktop",JSON.stringify(t.desktop)),this.router.navigate(["/assistant/desktop"])):this.snack.open("No se pudo tomar un escritorio",null,{duration:2e3})}))}readDesktops(t){this.userService.readDesktops(t).subscribe(t=>{t.ok&&(this.desktops=t.desktops,this.desktopsAvailable=this.desktops.filter(t=>null===t.id_session),this.myDesktop=this.desktops.filter(t=>{var e;return(null===(e=t.id_session)||void 0===e?void 0:e.id_assistant._id)===this.userService.user._id})[0]),this.myDesktop?(this.userService.desktop=this.myDesktop,localStorage.setItem("desktop",JSON.stringify(this.myDesktop))):(this.userService.desktop=null,localStorage.getItem("desktop")&&localStorage.removeItem("desktop"))},()=>{this.loading=!1},()=>{this.loading=!1})}releaseDesktop(t){this.loading=!0;let e=this.userService.user.id_company._id;this.userService.releaseDesktop(t._id).subscribe(t=>{this.readDesktops(e)},()=>{this.loading=!1},()=>{this.loading=!1})}ngOnDestroy(){this.userSuscription&&this.userSuscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(u.Mb(n.b),u.Mb(k.a),u.Mb(v.a))},t.\u0275cmp=u.Gb({type:t,selectors:[["app-home"]],decls:8,vars:2,consts:[[1,"saturno-container","shadow-box","animated","fadeIn","p-2"],["class","animated fadeIn",4,"ngIf"],[1,"my-4"],["routerLink","/assistant/dashboard","role","button",1,"btn","btn-primary","btn-block"],[1,"animated","fadeIn"],[1,"lead"],["class","card lead bg-danger text-white p-3 my-4","style","line-height: initial;",4,"ngIf"],[4,"ngIf"],[1,"card","lead","bg-danger","text-white","p-3","my-4",2,"line-height","initial"],["class","my-4",4,"ngIf"],[1,"card","bg-secondary","mb-4"],[1,"card-content","table-responsive-sm","p-2"],[1,"table","table-sm","text-white","text-center"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[2,"text-align","right","border","none"],[4,"ngFor","ngForOf"],["role","button",1,"btn","btn-success","btn-lg","m-1",3,"click"],["role","button",1,"btn","btn-danger","btn-lg","m-1",3,"click"],["class","card bg-danger text-white p-2 my-4",4,"ngIf"],[1,"card","bg-danger","text-white","p-2","my-4"],["appearance","fill",1,"w-100"],["matNativeControl","","required",""],["selectDesktop",""],[3,"value",4,"ngFor","ngForOf"],["role","button",1,"btn","btn-success","btn-block",3,"click"],[3,"value"],[2,"text-align","left"],[2,"text-align","right"],["style","color: mediumspringgreen;",4,"ngIf"],[2,"color","mediumspringgreen"]],template:function(t,e){1&t&&(u.Sb(0,"div",0),u.vc(1,$,2,0,"div",1),u.vc(2,K,6,3,"div",1),u.Nb(3,"hr",2),u.Sb(4,"p"),u.wc(5," Recuerde que si se ausenta del escritorio debe finalizar la sesi\xf3n del escritorio. Si usted finaliza la sesi\xf3n de user se finalizar\xe1 tambi\xe9n la sesi\xf3n del escritorio. Si la sesi\xf3n del escritorio ten\xeda asignada una sesi\xf3n de turno, este turno finalizar\xe1. "),u.Rb(),u.Sb(6,"a",3),u.wc(7,"Dashboard"),u.Rb(),u.Rb()),2&t&&(u.Ab(1),u.jc("ngIf",e.loading),u.Ab(1),u.jc("ngIf",!e.loading))},directives:[s.j,n.d,f.b,s.i,E.c,E.f,N.a,z.l],styles:[""]}),t})();var X=i("IheW"),Y=i("cxbk");let tt=(()=>{class t{constructor(t,e){this.http=t,this.userService=e}getUserMetrics(t,e){const i=new X.c({"turnos-token":this.userService.token});return this.http.post(Y.a.url+"/m/getusermetrics",{fcSel:t,idUser:e},{headers:i})}}return t.\u0275fac=function(e){return new(e||t)(u.Wb(X.a),u.Wb(k.a))},t.\u0275prov=u.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var et=i("e6WT"),it=i("TN/R"),st=i("wd/R"),nt=i.n(st);let ct=(()=>{class t{transform(t){return nt()(t).format("H:mm:ss")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=u.Lb({name:"timeToHms",type:t,pure:!0}),t})(),rt=(()=>{class t{transform(t,e){let i=nt.a.duration(e-t),s=i.hours(),n=i.minutes(),c=i.seconds();return`${s<=9?"0"+s.toString():s.toString()}:${n<=9?"0"+n.toString():n.toString()}:${c<=9?"0"+c.toString():c.toString()}`}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=u.Lb({name:"intervalToHms",type:t,pure:!0}),t})();function ot(t,e){1&t&&(u.Sb(0,"div",2),u.Nb(1,"mat-spinner"),u.Rb())}function at(t,e){if(1&t&&(u.Sb(0,"tr"),u.Sb(1,"td",25),u.wc(2),u.Rb(),u.Sb(3,"td",26),u.wc(4),u.ec(5,"timeToHms"),u.Rb(),u.Sb(6,"td",26),u.wc(7),u.ec(8,"intervalToHms"),u.Rb(),u.Sb(9,"td",26),u.wc(10),u.ec(11,"timeToHms"),u.Rb(),u.Sb(12,"td",26),u.wc(13),u.ec(14,"intervalToHms"),u.Rb(),u.Sb(15,"td",27),u.wc(16),u.ec(17,"timeToHms"),u.Rb(),u.Rb()),2&t){const t=e.$implicit;u.Ab(2),u.zc(" ",t.id_skill.cd_skill," ",t.id_position," "),u.Ab(2),u.yc(" ",u.fc(5,7,t.tm_start)," "),u.Ab(3),u.yc(" ",u.gc(8,9,t.tm_start,t.tm_att)," "),u.Ab(3),u.yc(" ",u.fc(11,12,t.tm_att)," "),u.Ab(3),u.yc(" ",u.gc(14,14,t.tm_att,t.tm_end)," "),u.Ab(3),u.yc(" ",u.fc(17,17,t.tm_end)," ")}}function bt(t,e){if(1&t){const t=u.Tb();u.Sb(0,"div"),u.Sb(1,"div",3),u.Sb(2,"div",4),u.Sb(3,"div",5),u.Sb(4,"mat-form-field",6),u.Sb(5,"mat-label"),u.wc(6,"Angular forms"),u.Rb(),u.Sb(7,"input",7),u.Zb("dateChange",(function(e){return u.pc(t),u.dc().setDate(e)})),u.Rb(),u.Nb(8,"mat-datepicker-toggle",8),u.Nb(9,"mat-datepicker",null,9),u.Rb(),u.Rb(),u.Rb(),u.Sb(11,"div",10),u.Sb(12,"div",11),u.Sb(13,"div",12),u.Sb(14,"div",13),u.wc(15,"Turnos"),u.Rb(),u.Sb(16,"div",14),u.wc(17),u.Rb(),u.Rb(),u.Rb(),u.Sb(18,"div",11),u.Sb(19,"div",15),u.Sb(20,"div",13),u.wc(21,"Evals"),u.Rb(),u.Sb(22,"div",14),u.wc(23),u.Rb(),u.Rb(),u.Rb(),u.Sb(24,"div",11),u.Sb(25,"div",16),u.Sb(26,"div",13),u.wc(27,"Score"),u.Rb(),u.Sb(28,"div",14),u.wc(29),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Sb(30,"div",4),u.Sb(31,"div",11),u.Sb(32,"div",17),u.Sb(33,"div",18),u.Sb(34,"table",19),u.Sb(35,"tr",20),u.Sb(36,"td",21),u.wc(37,"Ticket"),u.Rb(),u.Sb(38,"td",22),u.wc(39,"Start"),u.Rb(),u.Sb(40,"td",22),u.wc(41," - "),u.Rb(),u.Sb(42,"td",22),u.wc(43,"Atteneded"),u.Rb(),u.Sb(44,"td",22),u.wc(45," - "),u.Rb(),u.Sb(46,"td",23),u.wc(47,"End"),u.Rb(),u.Rb(),u.vc(48,at,18,19,"tr",24),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb()}if(2&t){const t=u.oc(10),e=u.dc();u.Ab(7),u.jc("matDatepicker",t)("value",e.date),u.Ab(1),u.jc("for",t),u.Ab(9),u.yc(" ",e.metrics.tickets.length," "),u.Ab(6),u.yc(" ",e.metrics.total," "),u.Ab(6),u.yc(" ",e.metrics.avg," "),u.Ab(19),u.jc("ngForOf",e.metrics.tickets)}}const dt=[{path:"home",component:V},{path:"desktop",component:O},{path:"dashboard",component:(()=>{class t{constructor(t,e){this.metricService=t,this.userService=e,this.loading=!1,this.metrics={total:0,avg:0,tickets:[]},this.date=new Date}ngOnInit(){let t=(new Date).setHours(0,0,0,0);this.getMetrics(t)}setDate(t){let e=+new Date(t.value);this.date=new Date(e),this.getMetrics(e)}getMetrics(t){this.loading=!0,this.metricService.getUserMetrics(t,this.userService.user._id).subscribe(t=>{this.metrics=t.metrics,this.loading=!1},()=>{this.loading=!1})}}return t.\u0275fac=function(e){return new(e||t)(u.Mb(tt),u.Mb(k.a))},t.\u0275cmp=u.Gb({type:t,selectors:[["app-dashboard"]],decls:2,vars:2,consts:[["class","mt-5 animated fadeIn",4,"ngIf"],[4,"ngIf"],[1,"mt-5","animated","fadeIn"],[1,"saturno-container"],[1,"row"],[1,"col","w-100"],["appearance","fill",1,"w-100"],["matInput","",3,"matDatepicker","value","dateChange"],["matSuffix","",3,"for"],["picker1",""],[1,"row","mb-4"],[1,"col"],[1,"card","text-white","bg-success"],[1,"card-header"],[1,"card-body","saturno-container-mini-body"],[1,"card","text-white","bg-danger"],[1,"card","text-white","bg-primary"],[1,"card","bg-secondary","mb-4"],[1,"card-content","table-responsive-sm","p-2"],[1,"table","table-sm","text-white","text-center",2,"font-size","x-small"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[2,"text-align","center","border","none"],[2,"text-align","right","border","none"],[4,"ngFor","ngForOf"],[2,"text-align","left"],[2,"text-align","center"],[2,"text-align","right"]],template:function(t,e){1&t&&(u.vc(0,ot,2,0,"div",0),u.vc(1,bt,49,7,"div",1)),2&t&&(u.jc("ngIf",e.loading),u.Ab(1),u.jc("ngIf",!e.loading))},directives:[s.j,f.b,E.c,E.f,et.b,it.b,it.d,E.g,it.a,s.i],pipes:[ct,rt],styles:[""]}),t})()},{path:"",redirectTo:"/assistant/home",pathMatch:"full"},{path:"**",component:M.a}];let lt=(()=>{class t{}return t.\u0275mod=u.Kb({type:t}),t.\u0275inj=u.Jb({factory:function(e){return new(e||t)},imports:[[n.e.forChild(dt)],n.e]}),t})();var ut=i("1+r1");let ht=(()=>{class t{}return t.\u0275mod=u.Kb({type:t}),t.\u0275inj=u.Jb({factory:function(e){return new(e||t)},imports:[[g.i,s.b,ut.a,lt]]}),t})()}}]);
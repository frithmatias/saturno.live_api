(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{dQ6A:function(t,e,i){"use strict";i.r(e),i.d(e,"AssistantModule",(function(){return gt}));var s=i("SVse"),n=i("s7LF"),c=i("iInd"),a=i("AIE+"),o=i("mrSG"),r=i("XNiG"),d=i("l5mm"),b=i("lJxs"),l=i("IzEk"),u=i("vkgz"),h=i("1G5W"),g=i("8Y7J"),S=i("EFyh"),m=i("kWJr"),v=i("Gyf/"),k=i("zHaW"),p=i("jMqV"),f=i("pu8Q"),R=i("zQhy");function x(t,e){1&t&&(g.Sb(0,"div",18),g.Nb(1,"mat-spinner"),g.Rb())}function w(t,e){1&t&&(g.Sb(0,"span"),g.Nb(1,"span",36),g.Rb())}function y(t,e){if(1&t&&(g.Sb(0,"div"),g.Sb(1,"div"),g.xc(2," Atendiendo turno "),g.Rb(),g.Sb(3,"div",37),g.Sb(4,"div",38),g.xc(5),g.Rb(),g.Rb(),g.Rb()),2&t){const t=g.dc(2);g.Ab(5),g.Ac(" ",null==t.assistantService.ticket.id_skill?null:t.assistantService.ticket.id_skill.cd_skill," ",t.assistantService.ticket.id_position," ")}}function _(t,e){if(1&t&&(g.Sb(0,"div"),g.xc(1),g.Rb()),2&t){const t=g.dc(2);g.Ab(1),g.zc(" ",t.message," ")}}const A=function(){return["/admin/assistants"]};function T(t,e){1&t&&(g.Sb(0,"div",39),g.Sb(1,"p"),g.xc(2," Usted no tiene habilidades asignadas. Debe ir al administrador de asistentes, luego seleccionar el asistente y all\xed asignarle skills / habilidades. "),g.Sb(3,"button",40),g.xc(4,"ADMINISTRADOR DE ASISTENTES"),g.Rb(),g.Rb(),g.Rb()),2&t&&(g.Ab(3),g.jc("routerLink",g.lc(1,A)))}function I(t,e){1&t&&g.Nb(0,"span",45)}function C(t,e){if(1&t&&(g.Sb(0,"span"),g.Nb(1,"mat-radio-button",46),g.Rb()),2&t){const t=g.dc().$implicit;g.Ab(1),g.jc("value",t.id)}}function j(t,e){if(1&t&&(g.Sb(0,"tr"),g.Sb(1,"td",41),g.wc(2,I,1,0,"span",42),g.wc(3,C,2,1,"span",22),g.Rb(),g.Sb(4,"td",43),g.xc(5),g.Rb(),g.Sb(6,"td",44),g.xc(7),g.Rb(),g.Rb()),2&t){const t=e.$implicit,i=g.dc(2);g.Ab(2),g.jc("ngIf",t.assigned),g.Ab(1),g.jc("ngIf",!t.assigned&&!i.waitForClient&&i.assistantService.ticket),g.Ab(2),g.zc(" ",t.tx_skill," "),g.Ab(2),g.zc(" ",t.tickets.length," ")}}function D(t,e){if(1&t){const t=g.Tb();g.Sb(0,"div",19),g.Sb(1,"div",20),g.Sb(2,"div",21),g.Sb(3,"span"),g.xc(4),g.Rb(),g.wc(5,w,2,0,"span",22),g.Rb(),g.Sb(6,"div",23),g.Sb(7,"div",24),g.wc(8,y,6,2,"div",22),g.wc(9,_,2,1,"div",22),g.Rb(),g.Rb(),g.Sb(10,"div",25),g.Sb(11,"div",5),g.Sb(12,"div",26),g.Sb(13,"div"),g.xc(14,"TE"),g.Rb(),g.Sb(15,"div"),g.xc(16),g.Rb(),g.Rb(),g.Sb(17,"div",26),g.Sb(18,"div"),g.xc(19,"TA"),g.Rb(),g.Sb(20,"div"),g.xc(21),g.Rb(),g.Rb(),g.Sb(22,"div",26),g.Sb(23,"div"),g.xc(24,"Tm"),g.Rb(),g.Sb(25,"div"),g.xc(26),g.Rb(),g.Rb(),g.Sb(27,"div",26),g.Sb(28,"div"),g.xc(29,"TC"),g.Rb(),g.Sb(30,"div"),g.xc(31),g.Rb(),g.Rb(),g.Rb(),g.Rb(),g.Rb(),g.wc(32,T,5,2,"div",27),g.Sb(33,"div",28),g.Sb(34,"div",29),g.Sb(35,"mat-radio-group",30),g.Zb("ngModelChange",(function(e){return g.qc(t),g.dc().skillSelected=e})),g.Sb(36,"table",31),g.Sb(37,"tr",32),g.Nb(38,"td",33),g.Sb(39,"td",33),g.xc(40,"Skill"),g.Rb(),g.Sb(41,"td",34),g.xc(42," En espera "),g.Rb(),g.Rb(),g.wc(43,j,8,4,"tr",35),g.Rb(),g.Rb(),g.Rb(),g.Rb(),g.Rb()}if(2&t){const t=g.dc();g.Ab(4),g.zc(" ESCRITORIO ",null==t.assistantService.desktop?null:t.assistantService.desktop.cd_desktop," "),g.Ab(1),g.jc("ngIf",t.comingClient),g.Ab(3),g.jc("ngIf",t.assistantService.ticket),g.Ab(1),g.jc("ngIf",t.message),g.Ab(7),g.yc(t.tmWaitingStr),g.Ab(5),g.yc(t.tmAttention),g.Ab(5),g.yc(t.timerCount),g.Ab(5),g.yc(t.pendingTicketsCount),g.Ab(1),g.jc("ngIf",0===t.skillsAssistantThisCompany.length),g.Ab(3),g.jc("ngModel",t.skillSelected),g.Ab(8),g.jc("ngForOf",t.pendingTicketsBySkill)}}const F=function(t){return{"button-disabled":t}};let O=(()=>{class t{constructor(t,e,i,s,n){this.loginService=t,this.assistantService=e,this.wsService=i,this.snack=s,this.router=n,this.loading=!1,this.waitForClient=!1,this.comingClient=!1,this.pendingTicketsCount=0,this.pendingTicketsBySkill=[],this.timerCount=2,this.tmWaitingStr="--:--:--",this.tmAttention="--:--:--",this.message="",this.skills=[],this.skillsAssistantThisCompany=[],this.skillSelected="",this.blPriority=!1,this.subjectUpdateTickets$=new r.a,this.subjectTurnoCancelado$=new r.a}ngOnInit(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0,this.assistantService.desktop?(yield this.readSkills().then(t=>{this.skills=t}).catch(()=>{this.snack.open("Error al obtener los skills",null,{duration:2e3})}),yield this.getTickets(),this.wsService.escucharUpdateDesktops().subscribe(this.subjectUpdateTickets$),this.subjectUpdateTickets$.subscribe(()=>{this.getTickets()}),this.wsService.escucharTicketCancelled().subscribe(this.subjectTurnoCancelado$),this.subjectTurnoCancelado$.subscribe(t=>{var e;t===(null===(e=this.assistantService.ticket)||void 0===e?void 0:e._id)&&(this.snack.open("El turno fue cancelado por el cliente",null,{duration:1e4}),this.clearTicketSession(),this.getTickets())}),this.loading=!1):this.router.navigate(["/assistant/home"])}))}getTickets(){var t;return Object(o.a)(this,void 0,void 0,(function*(){let e=null===(t=this.loginService.user.id_company)||void 0===t?void 0:t._id;return this.assistantService.getTickets(e).subscribe(t=>{const e=t.tickets.filter(t=>{var e,i;return(null===(e=t.id_session)||void 0===e?void 0:e.id_desktop._id)===this.assistantService.desktop.id_session.id_desktop._id&&void 0!==(null===(i=t.id_session)||void 0===i?void 0:i.id_desktop._id)&&null!==t.tm_att&&null===t.tm_end&&null===t.id_child})[0];e?(this.message="Existe un ticket pendiente de resoluci\xf3n",this.assistantService.ticket=e,localStorage.setItem("ticket",JSON.stringify(e))):delete this.assistantService.ticket;let i=this.skills,s=[];this.loginService.user.id_skills.forEach(t=>s.push(t._id));const n=t.tickets.filter(t=>{var e;return null===t.tm_end&&s.includes(null===(e=t.id_skill)||void 0===e?void 0:e._id)}),c=t.tickets.filter(t=>null===t.tm_end);this.pendingTicketsCount=n.length,this.message=n.length>0?`Hay ${n.length} turnos en espera`:"No hay turnos pendientes.",this.pendingTicketsBySkill=[];for(let a of i)s.includes(a._id)&&this.skillsAssistantThisCompany.push(a),this.pendingTicketsBySkill.push({id:a._id,assigned:s.includes(a._id),cd_skill:a.cd_skill,tx_skill:a.tx_skill,tickets:c.filter(t=>{var e;return(null===(e=t.id_skill)||void 0===e?void 0:e._id)===a._id&&null===t.tm_end})});this.loading=!1})}))}clearTicketSession(){delete this.assistantService.ticket,delete this.assistantService.chatMessages,localStorage.getItem("ticket")&&localStorage.removeItem("ticket"),this.tmWaitingStr="--:--:--",this.tmAttention="--:--:--",this.timerCount=2,this.waitForClient=!1,this.tmWaitingSub&&this.tmWaitingSub.unsubscribe(),this.tmExtraTimeSub&&this.tmExtraTimeSub.unsubscribe(),this.tmRunSub&&this.tmRunSub.unsubscribe(),this.getTickets()}clearDesktopSession(){delete this.assistantService.desktop,localStorage.getItem("desktop")&&localStorage.removeItem("desktop"),this.router.navigate(["assistant/home"])}releaseDesktop(){return Object(o.a)(this,void 0,void 0,(function*(){if(this.assistantService.ticket){let t="Tiene una sesi\xf3n de turno activa. \xbfDesea finalizarla?";return yield this.askForContinue(t).then(()=>{this.assistantService.endTicket(this.assistantService.ticket._id).subscribe(t=>{if(t.ok){let e=this.assistantService.ticket._id;this.clearTicketSession(),this.assistantService.releaseDesktop(e).subscribe(e=>{e.ok?this.clearDesktopSession():this.message=t.msg})}})}).catch(()=>{})}this.assistantService.releaseDesktop(this.assistantService.desktop._id).subscribe(t=>{t.ok&&this.clearDesktopSession()})}))}readSkills(){return new Promise((t,e)=>{var i;let s=null===(i=this.loginService.user.id_company)||void 0===i?void 0:i._id;this.assistantService.readSkills(s).subscribe(i=>{i.ok?t(i.skills):e([])})})}askForContinue(t){return new Promise((e,i)=>{this.snack.open(t,"ACEPTAR",{duration:5e3}).afterDismissed().subscribe(t=>{t.dismissedByAction?e():i()})})}takeTicket(){return Object(o.a)(this,void 0,void 0,(function*(){this.assistantService.ticket||this.assistantService.takeTicket(this.assistantService.desktop.id_session._id,this.wsService.idSocket).subscribe(t=>{if(this.snack.open(t.msg,null,{duration:2e3}),t.ok){this.waitForClient=!0,this.message="",this.assistantService.ticket=t.ticket,localStorage.setItem("ticket",JSON.stringify(t.ticket)),this.tmWaitingStr=this.assistantService.getTimeInterval(t.ticket.tm_start,t.ticket.tm_att);const e=this.wsService.escucharEnCamino(),i=Object(d.a)(1e3).pipe(Object(b.a)(t=>t+1),Object(l.a)(2));let s=!1;this.tmWaitingSub=i.pipe(Object(u.a)(t=>this.timerCount=2-t),Object(h.a)(e)).subscribe(t=>{t>=1&&(s=!0)},void 0,()=>{new Promise(t=>{if(s)this.waitForClient=!1,this.comingClient=!1,t();else{this.waitForClient=!0,this.comingClient=!0;const e=Object(d.a)(1e3).pipe(Object(b.a)(t=>t+1),Object(l.a)(5));this.tmExtraTimeSub=e.subscribe(t=>this.timerCount=5-t,void 0,()=>{this.waitForClient=!1,this.comingClient=!1,t()})}}).then(()=>{const t=Object(d.a)(1e3),e=(new Date).getTime();this.tmRunSub=t.subscribe(t=>{this.tmAttention=this.assistantService.getTimeInterval(e,+new Date)})})})}else this.waitForClient=!1,this.message=t.msg}),this.getTickets()}))}releaseTicket(){return Object(o.a)(this,void 0,void 0,(function*(){if(this.assistantService.ticket){let t="Desea soltar el ticket y devolverlo a su estado anterior?";yield this.askForContinue(t).then(()=>{this.assistantService.releaseTicket(this.assistantService.ticket._id).subscribe(t=>{t.ok&&(delete this.assistantService.ticket,this.clearTicketSession(),this.message=t.msg)})}).catch(()=>{})}}))}reassignTicket(){return Object(o.a)(this,void 0,void 0,(function*(){if(this.assistantService.ticket){let t="Desea enviar el ticket al skill seleccionado?";yield this.askForContinue(t).then(()=>{var t;let e=null===(t=this.assistantService.ticket)||void 0===t?void 0:t._id,i=this.skillSelected;e&&i&&this.assistantService.reassignTicket(e,i,this.blPriority).subscribe(t=>{t.ok&&(this.blPriority=!1,this.clearTicketSession(),this.message=t.msg)})}).catch(()=>{})}}))}endTicket(){return Object(o.a)(this,void 0,void 0,(function*(){if(this.assistantService.ticket){let t="Desea finalizar el ticket actual?";yield this.askForContinue(t).then(()=>{this.assistantService.endTicket(this.assistantService.ticket._id).subscribe(t=>{t.ok&&(this.clearTicketSession(),this.message=t.msg)})}).catch(()=>{})}}))}ngOnDestroy(){this.subjectUpdateTickets$.complete(),this.subjectTurnoCancelado$.complete()}}return t.\u0275fac=function(e){return new(e||t)(g.Mb(S.a),g.Mb(m.a),g.Mb(v.a),g.Mb(k.a),g.Mb(c.b))},t.\u0275cmp=g.Gb({type:t,selectors:[["app-desktop"]],decls:39,vars:24,consts:[[1,"saturno-desktop-background"],[1,"saturno-container","shadow-box","animated","fadeIn",2,"padding-bottom","3em"],["class","mt-5 animated fadeIn",4,"ngIf"],["class","animated fadeIn",4,"ngIf"],[1,"container","bg-light","fixed-bottom","shadow-box","no-radius","text-center","py-1"],[1,"row"],[1,"col-4","col-sm-2","button-content"],[1,"mx-2","my-1",3,"ngModel","disabled","ngModelChange"],[1,"mdi","mdi-human-wheelchair","xl","mx-1"],[1,"btn","btn-success","button",3,"ngClass","disabled","click"],[1,"mdi","mdi-list-status","xl"],[1,"button-inner"],[1,"btn","btn-success","button",3,"disabled","ngClass","click"],[1,"mdi","mdi-chevron-right","xl"],[1,"mdi","mdi-replay","xl"],[1,"mdi","mdi-close","xl"],[1,"btn","btn-danger","button",3,"disabled","ngClass","click"],[1,"mdi","mdi-power","xl"],[1,"mt-5","animated","fadeIn"],[1,"animated","fadeIn"],[1,"card","bg-light","mb-4"],[1,"card-header","banner-title"],[4,"ngIf"],[1,"card-body"],[1,"container"],[1,"card-footer"],[1,"col","p-0"],["class","saturno-container card bg-danger text-white p-3 mb-4",4,"ngIf"],[1,"saturno-container","card","bg-secondary","mb-4"],[1,"card-content","table-responsive-sm","p-2"],[3,"ngModel","ngModelChange"],[1,"table","table-sm","text-white","text-center"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[2,"text-align","right","border","none"],[4,"ngFor","ngForOf"],[1,"mdi","mdi-walk",2,"float","right","color","green","font-size","x-large"],[1,"banner-content","xxxxl"],[1,"xxxl"],[1,"saturno-container","card","bg-danger","text-white","p-3","mb-4"],[1,"btn","btn-danger","btn-block","btn-sm","my-2",3,"routerLink"],[2,"padding","0","vertical-align","middle","font-size","16px"],["class","mdi mdi-check","style","color: greenyellow",4,"ngIf"],[2,"text-align","left"],[2,"text-align","right"],[1,"mdi","mdi-check",2,"color","greenyellow"],[2,"position","relative","left","4px","top","4px",3,"value"]],template:function(t,e){1&t&&(g.Sb(0,"div",0),g.Sb(1,"div",1),g.wc(2,x,2,0,"div",2),g.wc(3,D,44,11,"div",3),g.Rb(),g.Rb(),g.Sb(4,"div",4),g.Sb(5,"div",5),g.Sb(6,"div",6),g.Sb(7,"mat-slide-toggle",7),g.Zb("ngModelChange",(function(t){return e.blPriority=t})),g.Nb(8,"span",8),g.Rb(),g.Rb(),g.Sb(9,"div",6),g.Sb(10,"button",9),g.Zb("click",(function(){return e.reassignTicket()})),g.Sb(11,"div"),g.Nb(12,"div",10),g.Rb(),g.Sb(13,"div",11),g.xc(14," Asignar "),g.Rb(),g.Rb(),g.Rb(),g.Sb(15,"div",6),g.Sb(16,"button",12),g.Zb("click",(function(){return e.takeTicket()})),g.Sb(17,"div"),g.Nb(18,"div",13),g.Rb(),g.Sb(19,"div",11),g.xc(20," Siguiente "),g.Rb(),g.Rb(),g.Rb(),g.Sb(21,"div",6),g.Sb(22,"button",12),g.Zb("click",(function(){return e.releaseTicket()})),g.Sb(23,"div"),g.Nb(24,"div",14),g.Rb(),g.Sb(25,"div",11),g.xc(26," Soltar "),g.Rb(),g.Rb(),g.Rb(),g.Sb(27,"div",6),g.Sb(28,"button",12),g.Zb("click",(function(){return e.endTicket()})),g.Sb(29,"div"),g.Nb(30,"div",15),g.Rb(),g.Sb(31,"div",11),g.xc(32," Finalizar "),g.Rb(),g.Rb(),g.Rb(),g.Sb(33,"div",6),g.Sb(34,"button",16),g.Zb("click",(function(){return e.releaseDesktop()})),g.Sb(35,"div"),g.Nb(36,"div",17),g.Rb(),g.Sb(37,"div",11),g.xc(38," Salir "),g.Rb(),g.Rb(),g.Rb(),g.Rb(),g.Rb()),2&t&&(g.Ab(2),g.jc("ngIf",e.loading),g.Ab(1),g.jc("ngIf",!e.loading),g.Ab(4),g.jc("ngModel",e.blPriority)("disabled",e.waitForClient||!e.assistantService.ticket||""===e.skillSelected),g.Ab(3),g.jc("ngClass",g.mc(14,F,e.waitForClient||!e.assistantService.ticket||""===e.skillSelected))("disabled",e.waitForClient||!e.assistantService.ticket||""===e.skillSelected),g.Ab(6),g.jc("disabled",e.waitForClient||e.assistantService.ticket)("ngClass",g.mc(16,F,e.waitForClient||e.assistantService.ticket)),g.Ab(6),g.jc("disabled",e.waitForClient||!e.assistantService.ticket)("ngClass",g.mc(18,F,e.waitForClient||!e.assistantService.ticket)),g.Ab(6),g.jc("disabled",e.waitForClient||!e.assistantService.ticket)("ngClass",g.mc(20,F,e.waitForClient||!e.assistantService.ticket)),g.Ab(6),g.jc("disabled",e.waitForClient)("ngClass",g.mc(22,F,e.waitForClient)))},directives:[s.j,p.a,n.o,n.r,s.h,f.b,R.b,s.i,c.c,R.a],styles:[".saturno-desktop-background[_ngcontent-%COMP%]{height:100vh;background-image:url(myticket-background.24387b8acb702323a6b6.png);background-size:100px}.button-disabled[_ngcontent-%COMP%]{background-color:#f1f1f1;color:#c7c7c7}"]}),t})();var N=i("zuHl"),z=i("Q2Ze"),M=i("ZTz/"),E=i("UhP/");function $(t,e){1&t&&(g.Sb(0,"div",5),g.Nb(1,"mat-spinner"),g.Rb())}function W(t,e){1&t&&(g.Sb(0,"div",9),g.xc(1," No tiene asignada ning\xfana empresa. Debe seleccionarla desde el men\xfa prinicipal. "),g.Rb())}function Z(t,e){1&t&&(g.Sb(0,"div",9),g.xc(1," No tiene escritorios creados. Debe darlos de alta desde el Men\xfa de Administrador. "),g.Rb())}function H(t,e){if(1&t){const t=g.Tb();g.Sb(0,"div",2),g.xc(1),g.Sb(2,"div"),g.Sb(3,"button",20),g.Zb("click",(function(){g.qc(t);const e=g.dc(3);return e.takeDesktop(e.myDesktop)})),g.Nb(4,"span",21),g.xc(5,"Ingresar "),g.Rb(),g.Sb(6,"button",22),g.Zb("click",(function(){g.qc(t);const e=g.dc(3);return e.releaseDesktop(e.myDesktop)})),g.Nb(7,"span",23),g.xc(8,"Cerrar "),g.Rb(),g.Rb(),g.Rb()}if(2&t){const t=g.dc(3);g.Ab(1),g.zc(" Usted tiene tomado el escritorio ",t.myDesktop.cd_desktop," ")}}function P(t,e){1&t&&(g.Sb(0,"div",25),g.xc(1," Todos los escritorios estan tomados. "),g.Rb())}function U(t,e){if(1&t&&(g.Sb(0,"mat-option",31),g.xc(1),g.Rb()),2&t){const t=e.$implicit;g.jc("value",t),g.Ab(1),g.zc(" ",t.cd_desktop," ")}}function J(t,e){if(1&t){const t=g.Tb();g.Sb(0,"div",2),g.Sb(1,"mat-form-field",26),g.Sb(2,"mat-label"),g.xc(3,"Seleccione un escritorio"),g.Rb(),g.Sb(4,"mat-select",27,28),g.wc(6,U,2,2,"mat-option",29),g.Rb(),g.Rb(),g.Sb(7,"button",30),g.Zb("click",(function(){g.qc(t);const e=g.pc(5);return g.dc(4).takeDesktop(null==e?null:e.value)})),g.xc(8," Ingresar "),g.Rb(),g.Rb()}if(2&t){const t=g.dc(4);g.Ab(6),g.jc("ngForOf",t.desktopsAvailable)}}function q(t,e){if(1&t&&(g.Sb(0,"div",2),g.wc(1,P,2,0,"div",24),g.wc(2,J,9,1,"div",10),g.Rb()),2&t){const t=g.dc(3);g.Ab(1),g.jc("ngIf",0===t.desktopsAvailable.length),g.Ab(1),g.jc("ngIf",t.desktopsAvailable.length>0)}}function G(t,e){if(1&t&&(g.Sb(0,"div"),g.xc(1),g.Rb()),2&t){const t=g.dc().$implicit;g.Ab(1),g.zc(" ",null==t.id_session?null:t.id_session.id_assistant.tx_name," ")}}function B(t,e){1&t&&(g.Sb(0,"div",35),g.xc(1," Disponible "),g.Rb())}function L(t,e){if(1&t&&(g.Sb(0,"tr"),g.Sb(1,"td",32),g.xc(2),g.Rb(),g.Sb(3,"td",33),g.wc(4,G,2,1,"div",8),g.wc(5,B,2,0,"div",34),g.Rb(),g.Rb()),2&t){const t=e.$implicit;g.Ab(2),g.zc(" ",t.cd_desktop," "),g.Ab(2),g.jc("ngIf",t.id_session),g.Ab(1),g.jc("ngIf",!t.id_session)}}function Q(t,e){if(1&t&&(g.Sb(0,"div"),g.wc(1,H,9,1,"div",10),g.wc(2,q,3,2,"div",10),g.Sb(3,"div",11),g.Sb(4,"div",12),g.Sb(5,"table",13),g.Sb(6,"tr",14),g.Sb(7,"td",15),g.Nb(8,"span",16),g.xc(9," Escritorio "),g.Rb(),g.Sb(10,"td",17),g.Nb(11,"span",18),g.xc(12," Asistente "),g.Rb(),g.Rb(),g.wc(13,L,6,3,"tr",19),g.Rb(),g.Rb(),g.Rb(),g.Rb()),2&t){const t=g.dc(2);g.Ab(1),g.jc("ngIf",t.myDesktop),g.Ab(1),g.jc("ngIf",!t.myDesktop),g.Ab(11),g.jc("ngForOf",t.desktops)}}function K(t,e){if(1&t&&(g.Sb(0,"div",5),g.Sb(1,"p",6),g.xc(2,"Bienvenido, desde aqu\xed puede tomar escritorios y atender turnos."),g.Rb(),g.wc(3,W,2,0,"div",7),g.wc(4,Z,2,0,"div",7),g.wc(5,Q,14,3,"div",8),g.Rb()),2&t){const t=g.dc();g.Ab(3),g.jc("ngIf",!t.loginService.user.id_company),g.Ab(1),g.jc("ngIf",0===(null==t.desktops?null:t.desktops.length)),g.Ab(1),g.jc("ngIf",(null==t.desktops?null:t.desktops.length)>0&&(null==t.loginService.user.id_company?null:t.loginService.user.id_company._id))}}let V=(()=>{class t{constructor(t,e,i,s,n){this.router=t,this.loginService=e,this.assistantService=i,this.sharedService=s,this.snack=n,this.loading=!1,this.desktops=[],this.desktopsAvailable=[]}ngOnInit(){var t;if(this.loading=!0,!(null===(t=this.loginService.user.id_company)||void 0===t?void 0:t._id))return this.sharedService.snackShow("No tiene una empresa seleccionada",5e3),void(this.loading=!1);this.readDesktops(this.loginService.user.id_company._id),this.userSuscription=this.loginService.user$.subscribe(t=>{t&&this.readDesktops(t.id_company._id)})}takeDesktop(t){t&&(this.assistantService.desktop?this.router.navigate(["/assistant/desktop"]):this.assistantService.takeDesktop(t._id,this.loginService.user._id).subscribe(t=>{this.snack.open(t.msg,null,{duration:2e3}),t.ok?(this.assistantService.desktop=t.desktop,localStorage.setItem("desktop",JSON.stringify(t.desktop)),this.router.navigate(["/assistant/desktop"])):this.snack.open("No se pudo tomar un escritorio",null,{duration:2e3})}))}readDesktops(t){this.assistantService.readDesktops(t).subscribe(t=>{t.ok&&(this.desktops=t.desktops,this.desktopsAvailable=this.desktops.filter(t=>null===t.id_session),this.myDesktop=this.desktops.filter(t=>{var e;return(null===(e=t.id_session)||void 0===e?void 0:e.id_assistant._id)===this.loginService.user._id})[0]),this.myDesktop?(this.assistantService.desktop=this.myDesktop,localStorage.setItem("desktop",JSON.stringify(this.myDesktop))):(delete this.assistantService.desktop,localStorage.getItem("desktop")&&localStorage.removeItem("desktop"))},()=>{this.loading=!1},()=>{this.loading=!1})}releaseDesktop(t){this.loading=!0;let e=this.loginService.user.id_company._id;this.assistantService.releaseDesktop(t._id).subscribe(t=>{this.readDesktops(e)},()=>{this.loading=!1},()=>{this.loading=!1})}ngOnDestroy(){this.userSuscription&&this.userSuscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(g.Mb(c.b),g.Mb(S.a),g.Mb(m.a),g.Mb(N.a),g.Mb(k.a))},t.\u0275cmp=g.Gb({type:t,selectors:[["app-home"]],decls:9,vars:2,consts:[[1,"saturno-container","shadow-box","animated","fadeIn","p-2"],["class","animated fadeIn",4,"ngIf"],[1,"my-4"],["routerLink","/assistant/dashboard","role","button",1,"btn","btn-primary","btn-block"],[1,"mdi","mdi-finance","mx-1"],[1,"animated","fadeIn"],[1,"lead"],["class","card lead bg-danger text-white p-3 my-4","style","line-height: initial;",4,"ngIf"],[4,"ngIf"],[1,"card","lead","bg-danger","text-white","p-3","my-4",2,"line-height","initial"],["class","my-4",4,"ngIf"],[1,"card","bg-secondary","mb-4"],[1,"card-content","table-responsive-sm","p-2"],[1,"table","table-sm","text-white","text-center"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[1,"mdi","mdi-monitor","mx-1"],[2,"text-align","right","border","none"],[1,"mdi","mdi-face-agent","mx-1"],[4,"ngFor","ngForOf"],["role","button",1,"btn","btn-success","m-2",3,"click"],[1,"mdi","mdi-import","mx-1"],["role","button",1,"btn","btn-danger","m-2",3,"click"],[1,"mdi","mdi-close-box-outline","mx-1"],["class","card bg-danger text-white p-2 my-4",4,"ngIf"],[1,"card","bg-danger","text-white","p-2","my-4"],[1,"w-100"],["matNativeControl","","required",""],["selectDesktop",""],[3,"value",4,"ngFor","ngForOf"],["role","button",1,"btn","btn-success","btn-block",3,"click"],[3,"value"],[2,"text-align","left"],[2,"text-align","right"],["style","color: mediumspringgreen;",4,"ngIf"],[2,"color","mediumspringgreen"]],template:function(t,e){1&t&&(g.Sb(0,"div",0),g.wc(1,$,2,0,"div",1),g.wc(2,K,6,3,"div",1),g.Nb(3,"hr",2),g.Sb(4,"p"),g.xc(5," Recuerde que si se ausenta del escritorio debe finalizar la sesi\xf3n del escritorio. Si usted finaliza la sesi\xf3n de user se finalizar\xe1 tambi\xe9n la sesi\xf3n del escritorio. Si la sesi\xf3n del escritorio ten\xeda asignada una sesi\xf3n de turno, este turno finalizar\xe1. "),g.Rb(),g.Sb(6,"button",3),g.Nb(7,"span",4),g.xc(8," Dashboard "),g.Rb(),g.Rb()),2&t&&(g.Ab(1),g.jc("ngIf",e.loading),g.Ab(1),g.jc("ngIf",!e.loading))},directives:[s.j,c.c,f.b,s.i,z.c,z.f,M.a,E.l],styles:[""]}),t})();var X=i("IheW"),Y=i("cxbk");let tt=(()=>{class t{constructor(t,e){this.http=t,this.loginService=e}getUserMetrics(t,e){const i=new X.c({"turnos-token":this.loginService.token});return this.http.post(Y.a.url+"/m/getusermetrics",{fcSel:t,idUser:e},{headers:i})}}return t.\u0275fac=function(e){return new(e||t)(g.Wb(X.a),g.Wb(S.a))},t.\u0275prov=g.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var et=i("e6WT"),it=i("TN/R"),st=i("wd/R"),nt=i.n(st);let ct=(()=>{class t{transform(t){return nt()(t).format("H:mm:ss")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=g.Lb({name:"timeToHms",type:t,pure:!0}),t})(),at=(()=>{class t{transform(t,e){let i=nt.a.duration(e-t),s=i.hours(),n=i.minutes(),c=i.seconds();return`${s<=9?"0"+s.toString():s.toString()}:${n<=9?"0"+n.toString():n.toString()}:${c<=9?"0"+c.toString():c.toString()}`}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=g.Lb({name:"intervalToHms",type:t,pure:!0}),t})();function ot(t,e){1&t&&(g.Sb(0,"div",2),g.Nb(1,"mat-spinner"),g.Rb())}function rt(t,e){if(1&t&&(g.Sb(0,"tr"),g.Sb(1,"td",25),g.xc(2),g.Rb(),g.Sb(3,"td",26),g.xc(4),g.ec(5,"timeToHms"),g.Rb(),g.Sb(6,"td",26),g.xc(7),g.ec(8,"intervalToHms"),g.Rb(),g.Sb(9,"td",26),g.xc(10),g.ec(11,"timeToHms"),g.Rb(),g.Sb(12,"td",26),g.xc(13),g.ec(14,"intervalToHms"),g.Rb(),g.Sb(15,"td",27),g.xc(16),g.ec(17,"timeToHms"),g.Rb(),g.Rb()),2&t){const t=e.$implicit;g.Ab(2),g.Ac(" ",t.id_skill.cd_skill," ",t.id_position," "),g.Ab(2),g.zc(" ",g.fc(5,7,t.tm_start)," "),g.Ab(3),g.zc(" ",g.gc(8,9,t.tm_start,t.tm_att)," "),g.Ab(3),g.zc(" ",g.fc(11,12,t.tm_att)," "),g.Ab(3),g.zc(" ",g.gc(14,14,t.tm_att,t.tm_end)," "),g.Ab(3),g.zc(" ",g.fc(17,17,t.tm_end)," ")}}function dt(t,e){if(1&t){const t=g.Tb();g.Sb(0,"div"),g.Sb(1,"div",3),g.Sb(2,"div",4),g.Sb(3,"div",5),g.Sb(4,"mat-form-field",6),g.Sb(5,"mat-label"),g.xc(6,"Angular forms"),g.Rb(),g.Sb(7,"input",7),g.Zb("dateChange",(function(e){return g.qc(t),g.dc().setDate(e)})),g.Rb(),g.Nb(8,"mat-datepicker-toggle",8),g.Nb(9,"mat-datepicker",null,9),g.Rb(),g.Rb(),g.Rb(),g.Sb(11,"div",10),g.Sb(12,"div",11),g.Sb(13,"div",12),g.Sb(14,"div",13),g.xc(15,"Turnos"),g.Rb(),g.Sb(16,"div",14),g.xc(17),g.Rb(),g.Rb(),g.Rb(),g.Sb(18,"div",11),g.Sb(19,"div",15),g.Sb(20,"div",13),g.xc(21,"Evals"),g.Rb(),g.Sb(22,"div",14),g.xc(23),g.Rb(),g.Rb(),g.Rb(),g.Sb(24,"div",11),g.Sb(25,"div",16),g.Sb(26,"div",13),g.xc(27,"Score"),g.Rb(),g.Sb(28,"div",14),g.xc(29),g.Rb(),g.Rb(),g.Rb(),g.Rb(),g.Sb(30,"div",4),g.Sb(31,"div",11),g.Sb(32,"div",17),g.Sb(33,"div",18),g.Sb(34,"table",19),g.Sb(35,"tr",20),g.Sb(36,"td",21),g.xc(37,"Ticket"),g.Rb(),g.Sb(38,"td",22),g.xc(39,"Start"),g.Rb(),g.Sb(40,"td",22),g.xc(41," - "),g.Rb(),g.Sb(42,"td",22),g.xc(43,"Atteneded"),g.Rb(),g.Sb(44,"td",22),g.xc(45," - "),g.Rb(),g.Sb(46,"td",23),g.xc(47,"End"),g.Rb(),g.Rb(),g.wc(48,rt,18,19,"tr",24),g.Rb(),g.Rb(),g.Rb(),g.Rb(),g.Rb(),g.Rb(),g.Rb()}if(2&t){const t=g.pc(10),e=g.dc();g.Ab(7),g.jc("matDatepicker",t)("value",e.date),g.Ab(1),g.jc("for",t),g.Ab(9),g.zc(" ",e.metrics.tickets.length," "),g.Ab(6),g.zc(" ",e.metrics.total," "),g.Ab(6),g.zc(" ",e.metrics.avg," "),g.Ab(19),g.jc("ngForOf",e.metrics.tickets)}}const bt=[{path:"home",component:V},{path:"desktop",component:O},{path:"dashboard",component:(()=>{class t{constructor(t,e){this.metricService=t,this.loginService=e,this.loading=!1,this.metrics={total:0,avg:0,tickets:[]},this.date=new Date}ngOnInit(){let t=(new Date).setHours(0,0,0,0);this.getMetrics(t)}setDate(t){let e=+new Date(t.value);this.date=new Date(e),this.getMetrics(e)}getMetrics(t){this.loading=!0,this.metricService.getUserMetrics(t,this.loginService.user._id).subscribe(t=>{this.metrics=t.metrics,this.loading=!1},()=>{this.loading=!1})}}return t.\u0275fac=function(e){return new(e||t)(g.Mb(tt),g.Mb(S.a))},t.\u0275cmp=g.Gb({type:t,selectors:[["app-dashboard"]],decls:2,vars:2,consts:[["class","mt-5 animated fadeIn",4,"ngIf"],[4,"ngIf"],[1,"mt-5","animated","fadeIn"],[1,"saturno-container"],[1,"row"],[1,"col","w-100"],[1,"w-100"],["matInput","",3,"matDatepicker","value","dateChange"],["matSuffix","",3,"for"],["picker1",""],[1,"row","mb-4"],[1,"col"],[1,"card","text-white","bg-success"],[1,"card-header"],[1,"card-body","saturno-container-mini-body"],[1,"card","text-white","bg-danger"],[1,"card","text-white","bg-primary"],[1,"card","bg-secondary","mb-4"],[1,"card-content","table-responsive-sm","p-2"],[1,"table","table-sm","text-white","text-center",2,"font-size","x-small"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[2,"text-align","center","border","none"],[2,"text-align","right","border","none"],[4,"ngFor","ngForOf"],[2,"text-align","left"],[2,"text-align","center"],[2,"text-align","right"]],template:function(t,e){1&t&&(g.wc(0,ot,2,0,"div",0),g.wc(1,dt,49,7,"div",1)),2&t&&(g.jc("ngIf",e.loading),g.Ab(1),g.jc("ngIf",!e.loading))},directives:[s.j,f.b,z.c,z.f,et.b,it.b,it.d,z.g,it.a,s.i],pipes:[ct,at],styles:[""]}),t})()},{path:"",redirectTo:"/assistant/home",pathMatch:"full"},{path:"**",component:a.a}];let lt=(()=>{class t{}return t.\u0275mod=g.Kb({type:t}),t.\u0275inj=g.Jb({factory:function(e){return new(e||t)},imports:[[c.e.forChild(bt)],c.e]}),t})();var ut=i("1+r1"),ht=i("iTUp");let gt=(()=>{class t{}return t.\u0275mod=g.Kb({type:t}),t.\u0275inj=g.Jb({factory:function(e){return new(e||t)},imports:[[n.i,s.b,ut.a,ht.a,lt]]}),t})()}}]);
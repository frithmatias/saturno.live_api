(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{Mhql:function(e,t,i){"use strict";i.r(t),i.d(t,"AsistenteModule",(function(){return Z}));var s=i("SVse"),n=i("iInd"),c=i("HDdC"),r=i("D0XW"),o=i("Y7HM");function a(e=0,t=r.a){return(!Object(o.a)(e)||e<0)&&(e=0),t&&"function"==typeof t.schedule||(t=r.a),new c.a(i=>(i.add(t.schedule(b,e,{subscriber:i,counter:0,period:e})),i))}function b(e){const{subscriber:t,counter:i,period:s}=e;t.next(i),this.schedule({subscriber:t,counter:i+1,period:s},s)}var d=i("lJxs"),l=i("IzEk"),u=i("vkgz"),v=i("1G5W"),h=i("8Y7J"),p=i("TGE+"),k=i("qfBg"),m=i("Gyf/"),f=i("zHaW"),g=i("Tj54");function P(e,t){1&e&&(h.Qb(0,"span"),h.Qb(1,"mat-icon",17),h.rc(2,"directions_walk"),h.Pb(),h.Pb())}function Q(e,t){if(1&e&&(h.Qb(0,"div"),h.Qb(1,"div",18),h.Qb(2,"div",19),h.rc(3," Atendiendo turno "),h.Pb(),h.Pb(),h.Qb(4,"div",18),h.Qb(5,"div",20),h.rc(6),h.Pb(),h.Pb(),h.Pb()),2&e){const e=h.Zb();h.zb(6),h.tc(" ",e.ticket.id_ticket," ")}}function S(e,t){1&e&&(h.Qb(0,"span"),h.rc(1," Disponible para atender "),h.Pb())}function w(e,t){if(1&e&&(h.Qb(0,"div",21),h.qc(1,S,2,0,"span",4),h.Pb()),2&e){const e=h.Zb();h.zb(1),h.ec("ngIf",!e.loading)}}function y(e,t){if(1&e&&(h.Qb(0,"div",22),h.rc(1),h.Pb()),2&e){const e=h.Zb();h.zb(1),h.sc(e.message)}}let z=(()=>{class e{constructor(e,t,i,s,n){this.activatedRoute=e,this.ticketsService=t,this.userService=i,this.wsService=s,this.snack=n,this.waitForClient=!1,this.comingClient=!1,this.pendingTickets=0,this.timerCount=10,this.tmWaiting="--:--:--",this.tmAttention="--:--:--",this.loading=!1,this.activatedRoute.params.subscribe(e=>{e.id&&(this.idDesk=e.id)})}ngOnInit(){this.wsService.escucharTurnos().subscribe(e=>{this.pendingTickets=Number(e)}),this.ticketsService.getPendingTicket(this.userService.usuario.id_company,this.idDesk).subscribe(e=>{this.snack.open(e.msg,null,{duration:5e3}),this.ticket=e.ok?e.ticket:null})}atenderTicket(){this.clearSession(),this.ticketsService.atenderTicket(this.idDesk,this.userService.usuario._id,this.wsService.idSocket).subscribe(e=>{if(e.ok){this.waitForClient=!0,this.message="",this.ticket=e.ticket,this.tmWaiting=this.ticketsService.getTimeInterval(e.ticket.tm_start,e.ticket.tm_att);const t=this.wsService.escucharEnCamino(),i=a(1e3).pipe(Object(d.a)(e=>e+1),Object(l.a)(10));let s=!1;i.pipe(Object(u.a)(e=>this.timerCount=10-e),Object(v.a)(t)).subscribe(e=>{e>=9&&(s=!0)},void 0,()=>{new Promise(e=>{s?(this.waitForClient=!1,this.comingClient=!1,e()):(this.waitForClient=!0,this.comingClient=!0,a(1e3).pipe(Object(d.a)(e=>e+1),Object(l.a)(20)).subscribe(e=>this.timerCount=20-e,void 0,()=>{this.waitForClient=!1,this.comingClient=!1,e()}))}).then(()=>{const e=a(1e3),t=(new Date).getTime(),i=e.subscribe(()=>{this.ticket?this.tmAttention=this.ticketsService.getTimeInterval(t,+new Date):i.unsubscribe()})})})}else this.waitForClient=!1,this.message=e.msg,this.snack.open(e.msg,"ACEPTAR",{duration:2e3})})}sendMessage(e){this.wsService.idSocket?e.value.length>0&&(this.wsService.emit("mensaje-privado",{mensaje:e.value}),e.value=""):this.snack.open("Se perdi\xf3 la conexi\xf3n con el escritorio.","ACEPTAR",{duration:5e3})}atenderInformes(){}devolverTicket(){this.clearSession(),this.ticketsService.devolverTicket(this.idDesk).subscribe(e=>{this.message=e.msg})}finalizarTicket(){this.clearSession(),this.ticketsService.finalizarTicket(this.idDesk).subscribe(e=>{this.message=e.msg})}clearSession(){this.ticketsService.chatMessages=[],this.ticket=null,this.tmWaiting="--:--:--",this.tmAttention="--:--:--"}}return e.\u0275fac=function(t){return new(t||e)(h.Lb(n.a),h.Lb(p.a),h.Lb(k.a),h.Lb(m.a),h.Lb(f.a))},e.\u0275cmp=h.Fb({type:e,selectors:[["app-desktop"]],decls:52,vars:13,consts:[[1,"m-4","row","animated","fadeIn"],[1,"col-lg-6"],[1,"card","text-white","bg-danger","mb-4"],[1,"card-header","banner-title"],[4,"ngIf"],[1,"banner-content",2,"background-color","rgb(141, 51, 51)"],[1,"container"],["class","my-4",4,"ngIf"],["class","card bg-danger text-white my-4 py-2",4,"ngIf"],[1,"row","banner-footer"],[1,"col","p-0"],[1,"row","py-2"],[1,"my-2","col-md-6","col-sm-12"],[1,"btn","btn-info","btn-block","btn-lg",3,"disabled","click"],[1,"btn","btn-success","btn-block","btn-lg",3,"disabled","click"],[1,"btn","btn-primary","btn-block","btn-lg",3,"disabled","click"],[1,"btn","btn-danger","btn-block","btn-lg",3,"disabled","click"],[2,"float","right","color","yellow","font-size","x-large"],[1,"row"],[1,"col"],[1,"col","xxxxl"],[1,"my-4"],[1,"card","bg-danger","text-white","my-4","py-2"]],template:function(e,t){1&e&&(h.Qb(0,"div",0),h.Qb(1,"div",1),h.Qb(2,"div",2),h.Qb(3,"div",3),h.Qb(4,"span"),h.rc(5),h.Pb(),h.qc(6,P,3,0,"span",4),h.Pb(),h.Qb(7,"div",5),h.Qb(8,"div",6),h.qc(9,Q,7,1,"div",4),h.qc(10,w,2,1,"div",7),h.qc(11,y,2,1,"div",8),h.Qb(12,"div",9),h.Qb(13,"div",10),h.Qb(14,"div"),h.rc(15,"TE"),h.Pb(),h.Qb(16,"div"),h.rc(17),h.Pb(),h.Pb(),h.Qb(18,"div",10),h.Qb(19,"div"),h.rc(20,"TA"),h.Pb(),h.Qb(21,"div"),h.rc(22),h.Pb(),h.Pb(),h.Qb(23,"div",10),h.Qb(24,"div"),h.rc(25,"Tm"),h.Pb(),h.Qb(26,"div"),h.rc(27),h.Pb(),h.Pb(),h.Qb(28,"div",10),h.Qb(29,"div"),h.rc(30,"TC"),h.Pb(),h.Qb(31,"div"),h.rc(32),h.Pb(),h.Pb(),h.Pb(),h.Pb(),h.Pb(),h.Pb(),h.Pb(),h.Qb(33,"div",1),h.Qb(34,"div",2),h.Qb(35,"div",3),h.rc(36," Panel "),h.Pb(),h.Qb(37,"div",5),h.Qb(38,"div",6),h.Qb(39,"div",11),h.Qb(40,"div",12),h.Qb(41,"button",13),h.Xb("click",(function(){return t.atenderInformes()})),h.rc(42," Informes "),h.Pb(),h.Pb(),h.Qb(43,"div",12),h.Qb(44,"button",14),h.Xb("click",(function(){return t.atenderTicket()})),h.rc(45," Siguiente "),h.Pb(),h.Pb(),h.Qb(46,"div",12),h.Qb(47,"button",15),h.Xb("click",(function(){return t.devolverTicket()})),h.rc(48," Devolver "),h.Pb(),h.Pb(),h.Qb(49,"div",12),h.Qb(50,"button",16),h.Xb("click",(function(){return t.finalizarTicket()})),h.rc(51," Finalizar "),h.Pb(),h.Pb(),h.Pb(),h.Pb(),h.Pb(),h.Pb(),h.Pb(),h.Pb()),2&e&&(h.zb(5),h.tc(" ESCRITORIO ",t.idDesk," "),h.zb(1),h.ec("ngIf",t.comingClient),h.zb(3),h.ec("ngIf",t.ticket),h.zb(1),h.ec("ngIf",!t.ticket),h.zb(1),h.ec("ngIf",t.message),h.zb(6),h.sc(t.tmWaiting),h.zb(5),h.sc(t.tmAttention),h.zb(5),h.sc(t.timerCount),h.zb(5),h.sc(t.pendingTickets),h.zb(9),h.ec("disabled",t.waitForClient),h.zb(3),h.ec("disabled",t.waitForClient),h.zb(3),h.ec("disabled",t.waitForClient),h.zb(3),h.ec("disabled",t.waitForClient))},directives:[s.j,g.a],styles:[""]}),e})();var I=i("AIE+"),D=i("Q2Ze"),T=i("ZTz/"),C=i("UhP/");function F(e,t){if(1&e&&(h.Qb(0,"mat-option",11),h.rc(1),h.Pb()),2&e){const e=t.$implicit;h.ec("value",e),h.zb(1),h.sc(e.cd_desktop)}}function O(e,t){if(1&e){const e=h.Rb();h.Qb(0,"div",4),h.Qb(1,"mat-form-field",6),h.Qb(2,"mat-label"),h.rc(3,"Seleccione"),h.Pb(),h.Qb(4,"mat-select",7,8),h.qc(6,F,2,2,"mat-option",9),h.Pb(),h.Pb(),h.Qb(7,"div"),h.Qb(8,"button",10),h.Xb("click",(function(){h.kc(e);const t=h.jc(5);return h.Zb().entrar(null==t?null:t.value)})),h.rc(9,"Ingresar"),h.Pb(),h.Pb(),h.Pb()}if(2&e){const e=h.Zb();h.zb(6),h.ec("ngForOf",e.desktopsAvailable)}}function _(e,t){if(1&e){const e=h.Rb();h.Qb(0,"div",4),h.rc(1),h.Qb(2,"div"),h.Qb(3,"button",12),h.Xb("click",(function(){h.kc(e);const t=h.Zb();return t.entrar(t.myDesktop)})),h.rc(4,"Ingresar"),h.Pb(),h.Qb(5,"button",13),h.Xb("click",(function(){h.kc(e);const t=h.Zb();return t.finalizar(t.myDesktop)})),h.rc(6,"Finalizar"),h.Pb(),h.Pb(),h.Pb()}if(2&e){const e=h.Zb();h.zb(1),h.tc(" Usted tiene tomado el escritorio ",e.myDesktop.cd_desktop," ")}}function j(e,t){if(1&e&&(h.Qb(0,"div"),h.rc(1),h.Pb()),2&e){const e=t.$implicit;h.zb(1),h.uc(" ",e.cd_desktop," tomado por ",e.id_assistant," ")}}function A(e,t){if(1&e&&(h.Qb(0,"div",4),h.rc(1," Todos los escritorios estan tomados. "),h.qc(2,j,2,2,"div",14),h.Pb()),2&e){const e=h.Zb();h.zb(2),h.ec("ngForOf",e.desktops)}}const q=[{path:"home",component:(()=>{class e{constructor(e,t,i){this.router=e,this.userService=t,this.snack=i,this.desktops=[],this.desktopsAvailable=[]}ngOnInit(){this.obtenerEscritorios()}entrar(e){e&&this.userService.takeDesktop(this.userService.usuario.id_company,e._id,this.userService.usuario._id).subscribe(t=>{this.snack.open(t.msg,null,{duration:2e3}),t.ok?(this.userService.desktop=t.desktop,localStorage.setItem("desktop",JSON.stringify(t.desktop)),this.router.navigate(["/asistente/escritorio",e.cd_desktop])):this.snack.open("No se pudo tomar un escritorio",null,{duration:2e3})})}obtenerEscritorios(){this.userService.readDesktops(this.userService.usuario.id_company).subscribe(e=>{this.desktops=e.desktops,this.desktopsAvailable=this.desktops.filter(e=>null===e.id_assistant),this.myDesktop=this.desktops.filter(e=>e.id_assistant===this.userService.usuario._id)[0],this.myDesktop?(this.userService.desktop=this.myDesktop,localStorage.setItem("desktop",JSON.stringify(this.myDesktop))):(this.userService.desktop=null,localStorage.getItem("desktop")&&localStorage.removeItem("desktop"))})}finalizar(e){this.userService.releaseDesktop(e).subscribe(e=>{this.obtenerEscritorios()})}}return e.\u0275fac=function(t){return new(t||e)(h.Lb(n.b),h.Lb(k.a),h.Lb(f.a))},e.\u0275cmp=h.Fb({type:e,selectors:[["app-home"]],decls:13,vars:3,consts:[[1,"jumbotron","m-4","animated","fadeIn"],[1,"display-4"],[1,"lead"],["class","my-4",4,"ngIf"],[1,"my-4"],["routerLink","/asistente/dashboard","role","button",1,"btn","btn-primary","btn-lg"],["appearance","fill"],["matNativeControl","","required",""],["selectDesktop",""],[3,"value",4,"ngFor","ngForOf"],["role","button",1,"btn","btn-success",3,"click"],[3,"value"],["role","button",1,"btn","btn-success","m-1",3,"click"],["role","button",1,"btn","btn-danger","m-1",3,"click"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&(h.Qb(0,"div",0),h.Qb(1,"h1",1),h.rc(2,"Bienvenido a la web del asistente"),h.Pb(),h.Qb(3,"p",2),h.rc(4,"Bienvenido, desde aqu\xed puede sacar un turno y evitar la sala de esperas."),h.Pb(),h.qc(5,O,10,1,"div",3),h.qc(6,_,7,1,"div",3),h.qc(7,A,3,1,"div",3),h.Mb(8,"hr",4),h.Qb(9,"p"),h.rc(10," Desde ac\xe1 podes ingresar a una ventanilla de atenci\xf3n. Desde el chat podra ver las consultas de los clientes una vez se les haya asignado esta ventanilla. Si desea puede tambi\xe9n atender consultas desde la ventanilla de informes para todas las consultas que todav\xeda permanecen en espera. "),h.Pb(),h.Qb(11,"a",5),h.rc(12,"Dashboard"),h.Pb(),h.Pb()),2&e&&(h.zb(5),h.ec("ngIf",!t.myDesktop),h.zb(1),h.ec("ngIf",t.myDesktop),h.zb(1),h.ec("ngIf",0===t.desktopsAvailable.length))},directives:[s.j,n.d,D.b,D.e,T.a,s.i,C.h],styles:[""]}),e})()},{path:"escritorio/:id",component:z},{path:"dashboard",component:(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=h.Fb({type:e,selectors:[["app-dashboard"]],decls:4,vars:0,consts:[[1,"container","animated","fadeIn"],[1,"row"],[1,"col"]],template:function(e,t){1&e&&(h.Qb(0,"div",0),h.Qb(1,"div",1),h.Qb(2,"div",2),h.rc(3," Dashboard "),h.Pb(),h.Pb(),h.Pb())},styles:[""]}),e})()},{path:"",redirectTo:"/asistente/home",pathMatch:"full"},{path:"**",component:I.a}];let x=(()=>{class e{}return e.\u0275mod=h.Jb({type:e}),e.\u0275inj=h.Ib({factory:function(t){return new(t||e)},imports:[[n.e.forChild(q)],n.e]}),e})();var E=i("1+r1");let Z=(()=>{class e{}return e.\u0275mod=h.Jb({type:e}),e.\u0275inj=h.Ib({factory:function(t){return new(t||e)},imports:[[s.b,E.a,x]]}),e})()}}]);
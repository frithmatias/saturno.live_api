(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{w8Di:function(t,e,i){"use strict";i.r(e),i.d(e,"AssistantModule",(function(){return Y}));var s=i("SVse"),n=i("iInd"),c=i("HDdC"),o=i("D0XW"),r=i("Y7HM");function a(t=0,e=o.a){return(!Object(r.a)(t)||t<0)&&(t=0),e&&"function"==typeof e.schedule||(e=o.a),new c.a(i=>(i.add(e.schedule(b,t,{subscriber:i,counter:0,period:t})),i))}function b(t){const{subscriber:e,counter:i,period:s}=t;e.next(i),this.schedule({subscriber:e,counter:i+1,period:s},s)}var l=i("lJxs"),d=i("IzEk"),u=i("vkgz"),k=i("1G5W"),p=i("8Y7J"),h=i("TGE+"),v=i("qfBg"),m=i("Gyf/"),f=i("zHaW"),g=i("Tj54");function R(t,e){1&t&&(p.Rb(0,"span"),p.Rb(1,"mat-icon",29),p.tc(2,"directions_walk"),p.Qb(),p.Qb())}function Q(t,e){if(1&t&&(p.Rb(0,"div"),p.Rb(1,"div",25),p.Rb(2,"div",26),p.tc(3," Atendiendo turno "),p.Qb(),p.Qb(),p.Rb(4,"div",25),p.Rb(5,"div",30),p.tc(6),p.Qb(),p.Qb(),p.Qb()),2&t){const t=p.ac();p.zb(6),p.wc(" ",t.ticketsService.myTicket.cd_skill," ",t.ticketsService.myTicket.id_ticket," ")}}function S(t,e){if(1&t&&(p.Rb(0,"div",31),p.tc(1),p.Qb()),2&t){const t=p.ac();p.zb(1),p.uc(t.message)}}function y(t,e){if(1&t&&(p.Rb(0,"tr"),p.Rb(1,"td",32),p.tc(2),p.Qb(),p.Rb(3,"td",33),p.tc(4),p.Qb(),p.Qb()),2&t){const t=e.$implicit;p.zb(2),p.vc(" ",t.tx_skill," "),p.zb(2),p.vc(" ",t.tickets.length," ")}}let w=(()=>{class t{constructor(t,e,i,s,n){this.ticketsService=t,this.userService=e,this.wsService=i,this.snack=s,this.router=n,this.waitForClient=!1,this.comingClient=!1,this.pendingTicketsCount=0,this.pendingTicketsBySkill=[],this.timerCount=10,this.tmWaiting="--:--:--",this.tmAttention="--:--:--"}ngOnInit(){var t;(null===(t=this.userService.desktop)||void 0===t?void 0:t.cd_desktop)?this.cdDesk=this.userService.desktop.cd_desktop:(this.snack.open("No tiene un escritorio asignado",null,{duration:2e3}),this.router.navigate(["/assistant/home"])),this.getTickets(),this.wsService.escucharTurnos().subscribe(t=>{this.getTickets()})}getTickets(){return t=this,void 0,i=function*(){const t=yield this.ticketsService.getTickets(),e=t.filter(t=>t.cd_desk===this.cdDesk&&null===t.tm_end)[0];e&&(this.message="Existe un ticket pendiente de resoluci\xf3n",this.snack.open("Existe un ticket pendiente",null,{duration:2e3}),localStorage.setItem("ticket",JSON.stringify(e)));const i=t.filter(t=>null===t.tm_end);this.pendingTicketsCount=i.length,i.length>0&&(this.message=`Hay ${i.length} tickets en espera`);const s=this.userService.usuario.id_skills;this.pendingTicketsBySkill=[];for(let n of s)this.pendingTicketsBySkill.push({cd_skill:n.cd_skill,tx_skill:n.tx_skill,tickets:i.filter(t=>t.id_skill===n._id&&null===t.tm_end)})},new((e=void 0)||(e=Promise))((function(s,n){function c(t){try{r(i.next(t))}catch(e){n(e)}}function o(t){try{r(i.throw(t))}catch(e){n(e)}}function r(t){var i;t.done?s(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(c,o)}r((i=i.apply(t,[])).next())}));var t,e,i}takeTicket(){this.ticketsService.takeTicket(this.cdDesk,this.userService.desktop._id,this.userService.usuario._id,this.wsService.idSocket).subscribe(t=>{if(this.snack.open(t.msg,null,{duration:2e3}),this.getTickets(),t.ok){this.waitForClient=!0,this.message="",this.ticketsService.myTicket=t.ticket,localStorage.setItem("ticket",JSON.stringify(t.ticket)),this.tmWaiting=this.ticketsService.getTimeInterval(t.ticket.tm_start,t.ticket.tm_att);const e=this.wsService.escucharEnCamino(),i=a(1e3).pipe(Object(l.a)(t=>t+1),Object(d.a)(10));let s=!1;i.pipe(Object(u.a)(t=>this.timerCount=10-t),Object(k.a)(e)).subscribe(t=>{t>=9&&(s=!0)},void 0,()=>{new Promise(t=>{s?(this.waitForClient=!1,this.comingClient=!1,t()):(this.waitForClient=!0,this.comingClient=!0,a(1e3).pipe(Object(l.a)(t=>t+1),Object(d.a)(20)).subscribe(t=>this.timerCount=20-t,void 0,()=>{this.waitForClient=!1,this.comingClient=!1,t()}))}).then(()=>{const t=a(1e3),e=(new Date).getTime(),i=t.subscribe(()=>{this.ticketsService.myTicket?this.tmAttention=this.ticketsService.getTimeInterval(e,+new Date):i.unsubscribe()})})})}else this.waitForClient=!1,this.message=t.msg,this.clearSession()}),this.getTickets()}assignTicket(){}releaseTicket(){this.ticketsService.releaseTicket(this.ticketsService.myTicket._id).subscribe(t=>{t.ok&&(this.clearSession(),this.message=t.msg)})}endTicket(){this.ticketsService.endTicket(this.ticketsService.myTicket._id).subscribe(t=>{t.ok&&(this.clearSession(),this.message=t.msg)})}clearSession(){this.ticketsService.myTicket=null,localStorage.getItem("ticket")&&localStorage.removeItem("ticket"),this.ticketsService.chatMessages=[],this.tmWaiting="--:--:--",this.tmAttention="--:--:--"}releaseDesktop(){this.userService.releaseDesktop(this.userService.desktop._id).subscribe(t=>{t.ok&&this.router.navigate(["assistant/home"])})}}return t.\u0275fac=function(e){return new(e||t)(p.Lb(h.a),p.Lb(v.a),p.Lb(m.a),p.Lb(f.a),p.Lb(n.b))},t.\u0275cmp=p.Fb({type:t,selectors:[["app-desktop"]],decls:62,vars:13,consts:[[1,"m-4","row","animated","fadeIn"],[1,"col-lg-6"],[1,"card","bg-light","mb-4"],[1,"card-header","banner-title"],[4,"ngIf"],[1,"banner-content"],[1,"container"],["class","card text-white my-4 p-2","style","background-color: darkcyan;",4,"ngIf"],[1,"row","banner-footer"],[1,"col","p-0"],[1,"content"],[1,"my-1"],[1,"row",2,"justify-content","space-between"],[1,"col","col-6","col-md-3","p-1"],[1,"btn","btn-block","btn-danger",3,"disabled","click"],[1,"btn","btn-block","btn-info",3,"disabled","click"],[1,"btn","btn-block","btn-primary",3,"disabled","click"],[1,"btn","btn-block","btn-success",3,"disabled","click"],[1,"card","bg-primary","mb-4"],[1,"card-content","table-responsive-sm","p-2"],[1,"table","table-sm","text-white","text-center",2,"font-size","large"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[2,"text-align","center","border","none"],[4,"ngFor","ngForOf"],[1,"row"],[1,"col"],[1,"text-center","footer-panel"],[1,"btn","btn-danger","text-uppercase","m-2",3,"click"],[2,"float","right","color","blueviolet","font-size","x-large"],[1,"col","xxxxl"],[1,"card","text-white","my-4","p-2",2,"background-color","darkcyan"],[2,"text-align","left"],[2,"text-align","center"]],template:function(t,e){1&t&&(p.Rb(0,"div",0),p.Rb(1,"div",1),p.Rb(2,"div",2),p.Rb(3,"div",3),p.Rb(4,"span"),p.tc(5),p.Qb(),p.sc(6,R,3,0,"span",4),p.Qb(),p.Rb(7,"div",5),p.Rb(8,"div",6),p.sc(9,Q,7,2,"div",4),p.sc(10,S,2,1,"div",7),p.Rb(11,"div",8),p.Rb(12,"div",9),p.Rb(13,"div"),p.tc(14,"TE"),p.Qb(),p.Rb(15,"div"),p.tc(16),p.Qb(),p.Qb(),p.Rb(17,"div",9),p.Rb(18,"div"),p.tc(19,"TA"),p.Qb(),p.Rb(20,"div"),p.tc(21),p.Qb(),p.Qb(),p.Rb(22,"div",9),p.Rb(23,"div"),p.tc(24,"Tm"),p.Qb(),p.Rb(25,"div"),p.tc(26),p.Qb(),p.Qb(),p.Rb(27,"div",9),p.Rb(28,"div"),p.tc(29,"TC"),p.Qb(),p.Rb(30,"div"),p.tc(31),p.Qb(),p.Qb(),p.Qb(),p.Rb(32,"div",10),p.Mb(33,"hr",11),p.Rb(34,"div",12),p.Rb(35,"div",13),p.Rb(36,"button",14),p.Yb("click",(function(){return e.releaseTicket()})),p.tc(37," Soltar "),p.Qb(),p.Qb(),p.Rb(38,"div",13),p.Rb(39,"button",15),p.Yb("click",(function(){return e.assignTicket()})),p.tc(40," Reasignar "),p.Qb(),p.Qb(),p.Rb(41,"div",13),p.Rb(42,"button",16),p.Yb("click",(function(){return e.endTicket()})),p.tc(43," Finalizar "),p.Qb(),p.Qb(),p.Rb(44,"div",13),p.Rb(45,"button",17),p.Yb("click",(function(){return e.takeTicket()})),p.tc(46," Siguiente "),p.Qb(),p.Qb(),p.Qb(),p.Qb(),p.Qb(),p.Qb(),p.Qb(),p.Qb(),p.Rb(47,"div",1),p.Rb(48,"div",18),p.Rb(49,"div",19),p.Rb(50,"table",20),p.Rb(51,"tr",21),p.Rb(52,"td",22),p.tc(53," Skill "),p.Qb(),p.Rb(54,"td",23),p.tc(55," Cola "),p.Qb(),p.Qb(),p.sc(56,y,5,2,"tr",24),p.Qb(),p.Qb(),p.Qb(),p.Qb(),p.Qb(),p.Rb(57,"div",25),p.Rb(58,"div",26),p.Rb(59,"div",27),p.Rb(60,"button",28),p.Yb("click",(function(){return e.releaseDesktop()})),p.tc(61,"Abandonar Escritorio"),p.Qb(),p.Qb(),p.Qb(),p.Qb()),2&t&&(p.zb(5),p.vc(" ESCRITORIO ",e.cdDesk," "),p.zb(1),p.fc("ngIf",e.comingClient),p.zb(3),p.fc("ngIf",e.ticketsService.myTicket),p.zb(1),p.fc("ngIf",e.message),p.zb(6),p.uc(e.tmWaiting),p.zb(5),p.uc(e.tmAttention),p.zb(5),p.uc(e.timerCount),p.zb(5),p.uc(e.pendingTicketsCount),p.zb(5),p.fc("disabled",e.waitForClient),p.zb(3),p.fc("disabled",!0),p.zb(3),p.fc("disabled",!e.ticketsService.myTicket||e.waitForClient),p.zb(3),p.fc("disabled",e.waitForClient),p.zb(11),p.fc("ngForOf",e.pendingTicketsBySkill))},directives:[s.j,s.i,g.a],styles:[".desktop-panel-buttons[_ngcontent-%COMP%]{font-size:1.5rem;position:relative;top:-.3rem;left:-.3rem}"]}),t})();var T=i("AIE+"),z=i("Q2Ze"),_=i("ZTz/"),D=i("UhP/");function I(t,e){if(1&t&&(p.Rb(0,"mat-option",13),p.tc(1),p.Qb()),2&t){const t=e.$implicit;p.fc("value",t),p.zb(1),p.vc("",t.cd_desktop," ")}}function C(t,e){if(1&t){const t=p.Sb();p.Rb(0,"div",6),p.Rb(1,"mat-form-field",8),p.Rb(2,"mat-label"),p.tc(3,"Seleccione un escritorio"),p.Qb(),p.Rb(4,"mat-select",9,10),p.sc(6,I,2,2,"mat-option",11),p.Qb(),p.Qb(),p.Rb(7,"div"),p.Rb(8,"button",12),p.Yb("click",(function(){p.mc(t);const e=p.lc(5);return p.ac().takeDesktop(null==e?null:e.value)})),p.tc(9,"Ingresar"),p.Qb(),p.Qb(),p.Qb()}if(2&t){const t=p.ac();p.zb(6),p.fc("ngForOf",t.desktopsAvailable)}}function x(t,e){if(1&t){const t=p.Sb();p.Rb(0,"div",6),p.tc(1),p.Rb(2,"div"),p.Rb(3,"button",14),p.Yb("click",(function(){p.mc(t);const e=p.ac();return e.takeDesktop(e.myDesktop)})),p.tc(4,"Ingresar"),p.Qb(),p.Rb(5,"button",15),p.Yb("click",(function(){p.mc(t);const e=p.ac();return e.releaseDesktop(e.myDesktop)})),p.tc(6,"Finalizar"),p.Qb(),p.Qb(),p.Qb()}if(2&t){const t=p.ac();p.zb(1),p.vc(" Usted tiene tomado el escritorio ",t.myDesktop.cd_desktop," ")}}function F(t,e){if(1&t&&(p.Rb(0,"div"),p.tc(1),p.Qb()),2&t){const t=e.$implicit;p.zb(1),p.wc(" ",t.cd_desktop," tomado por ",t.id_assistant," ")}}function O(t,e){if(1&t&&(p.Rb(0,"div",6),p.tc(1," Todos los escritorios estan tomados. "),p.sc(2,F,2,2,"div",16),p.Qb()),2&t){const t=p.ac();p.zb(2),p.fc("ngForOf",t.desktops)}}const j=[{path:"home",component:(()=>{class t{constructor(t,e,i){this.router=t,this.userService=e,this.snack=i,this.desktops=[],this.desktopsAvailable=[]}ngOnInit(){this.readDesktops()}takeDesktop(t){t&&this.userService.takeDesktop(t._id,this.userService.usuario._id).subscribe(t=>{this.snack.open(t.msg,null,{duration:2e3}),t.ok?(this.userService.desktop=t.desktop,localStorage.setItem("desktop",JSON.stringify(t.desktop)),this.router.navigate(["/assistant/desktop"])):this.snack.open("No se pudo tomar un escritorio",null,{duration:2e3})})}readDesktops(){this.userService.readDesktops(this.userService.usuario.id_company._id).subscribe(t=>{this.desktops=t.desktops,this.desktopsAvailable=this.desktops.filter(t=>null===t.id_assistant),this.myDesktop=this.desktops.filter(t=>t.id_assistant===this.userService.usuario._id)[0],this.myDesktop?(this.userService.desktop=this.myDesktop,localStorage.setItem("desktop",JSON.stringify(this.myDesktop))):(this.userService.desktop=null,localStorage.getItem("desktop")&&localStorage.removeItem("desktop"))})}releaseDesktop(t){this.userService.releaseDesktop(t._id).subscribe(t=>{this.readDesktops()})}}return t.\u0275fac=function(e){return new(e||t)(p.Lb(n.b),p.Lb(v.a),p.Lb(f.a))},t.\u0275cmp=p.Fb({type:t,selectors:[["app-home"]],decls:15,vars:3,consts:[[1,"turno-container","p-2",2,"text-align","-webkit-center"],[1,"card","bg-light","mb-3",2,"min-width","18rem","max-width","30rem"],[1,"jumbotron","m-2","animated","fadeIn"],[1,"display-4"],[1,"lead"],["class","my-4",4,"ngIf"],[1,"my-4"],["routerLink","/assistant/dashboard","role","button",1,"btn","btn-primary","btn-lg","btn-block"],["appearance","fill"],["matNativeControl","","required",""],["selectDesktop",""],[3,"value",4,"ngFor","ngForOf"],["role","button",1,"btn","btn-success","btn-lg","btn-block",3,"click"],[3,"value"],["role","button",1,"btn","btn-success","btn-lg","m-1",3,"click"],["role","button",1,"btn","btn-danger","btn-lg","m-1",3,"click"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(p.Rb(0,"div",0),p.Rb(1,"div",1),p.Rb(2,"div",2),p.Rb(3,"h1",3),p.tc(4,"Bienvenido a la web del asistente"),p.Qb(),p.Rb(5,"p",4),p.tc(6,"Bienvenido, desde aqu\xed puede tomar escritorios y atender turnos."),p.Qb(),p.sc(7,C,10,1,"div",5),p.sc(8,x,7,1,"div",5),p.sc(9,O,3,1,"div",5),p.Mb(10,"hr",6),p.Rb(11,"p"),p.tc(12," Recuerde que si se ausenta del escritorio debe finalizar la sesi\xf3n del escritorio. Si usted finaliza la sesi\xf3n de usuario se finalizar\xe1 tambi\xe9n la sesi\xf3n del escritorio. Si la sesi\xf3n del escritorio ten\xeda asignada una sesi\xf3n de turno, este turno finalizar\xe1. "),p.Qb(),p.Rb(13,"a",7),p.tc(14,"Dashboard"),p.Qb(),p.Qb(),p.Qb(),p.Qb()),2&t&&(p.zb(7),p.fc("ngIf",!e.myDesktop),p.zb(1),p.fc("ngIf",e.myDesktop),p.zb(1),p.fc("ngIf",0===e.desktopsAvailable.length))},directives:[s.j,n.d,z.c,z.f,_.a,s.i,D.h],styles:[""]}),t})()},{path:"desktop",component:w},{path:"dashboard",component:(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Fb({type:t,selectors:[["app-dashboard"]],decls:4,vars:0,consts:[[1,"container","animated","fadeIn"],[1,"row"],[1,"col"]],template:function(t,e){1&t&&(p.Rb(0,"div",0),p.Rb(1,"div",1),p.Rb(2,"div",2),p.tc(3," Dashboard "),p.Qb(),p.Qb(),p.Qb())},styles:[""]}),t})()},{path:"",redirectTo:"/assistant/home",pathMatch:"full"},{path:"**",component:T.a}];let A=(()=>{class t{}return t.\u0275mod=p.Jb({type:t}),t.\u0275inj=p.Ib({factory:function(e){return new(e||t)},imports:[[n.e.forChild(j)],n.e]}),t})();var J=i("1+r1");let Y=(()=>{class t{}return t.\u0275mod=p.Jb({type:t}),t.\u0275inj=p.Ib({factory:function(e){return new(e||t)},imports:[[s.b,J.a,A]]}),t})()}}]);
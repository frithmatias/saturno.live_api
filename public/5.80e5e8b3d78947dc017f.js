(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{Mhql:function(t,e,i){"use strict";i.r(e),i.d(e,"AsistenteModule",(function(){return J}));var s=i("SVse"),c=i("iInd"),n=i("HDdC"),r=i("D0XW"),o=i("Y7HM");function b(t=0,e=r.a){return(!Object(o.a)(t)||t<0)&&(t=0),e&&"function"==typeof e.schedule||(e=r.a),new n.a(i=>(i.add(e.schedule(a,t,{subscriber:i,counter:0,period:t})),i))}function a(t){const{subscriber:e,counter:i,period:s}=t;e.next(i),this.schedule({subscriber:e,counter:i+1,period:s},s)}var d=i("lJxs"),l=i("IzEk"),u=i("vkgz"),k=i("1G5W"),v=i("8Y7J"),h=i("TGE+"),p=i("qfBg"),m=i("Gyf/"),g=i("zHaW"),f=i("Tj54");function P(t,e){1&t&&(v.Qb(0,"span"),v.Qb(1,"mat-icon",17),v.rc(2,"directions_walk"),v.Pb(),v.Pb())}function Q(t,e){if(1&t&&(v.Qb(0,"div"),v.Qb(1,"div",18),v.Qb(2,"div",19),v.rc(3," Atendiendo turno "),v.Pb(),v.Pb(),v.Qb(4,"div",18),v.Qb(5,"div",20),v.rc(6),v.Pb(),v.Pb(),v.Pb()),2&t){const t=v.Zb();v.zb(6),v.tc(" ",t.ticket.id_ticket," ")}}function S(t,e){1&t&&(v.Qb(0,"span"),v.rc(1," Disponible para atender "),v.Pb())}function y(t,e){if(1&t&&(v.Qb(0,"div",21),v.qc(1,S,2,0,"span",4),v.Pb()),2&t){const t=v.Zb();v.zb(1),v.ec("ngIf",!t.loading)}}function w(t,e){if(1&t&&(v.Qb(0,"div",22),v.rc(1),v.Pb()),2&t){const t=v.Zb();v.zb(1),v.sc(t.message)}}let I=(()=>{class t{constructor(t,e,i,s,c){this.activatedRoute=t,this.ticketsService=e,this.userService=i,this.wsService=s,this.snack=c,this.waitForClient=!1,this.comingClient=!1,this.pendingTickets=0,this.timerCount=10,this.tmWaiting="--:--:--",this.tmAttention="--:--:--",this.loading=!1,this.activatedRoute.params.subscribe(t=>{t.id&&(this.cdDesk=t.id)})}ngOnInit(){this.wsService.escucharTurnos().subscribe(t=>{this.pendingTickets=Number(t)}),this.ticketsService.getPendingTicket(this.userService.desktop._id).subscribe(t=>{this.snack.open(t.msg,null,{duration:5e3}),t.ok?(this.ticket=t.ticket,this.ticketsService.myTicket=t.ticket,localStorage.setItem("ticket",JSON.stringify(t.ticket))):this.clearSession()})}atenderTicket(){this.ticketsService.atenderTicket(this.cdDesk,this.userService.desktop._id,this.userService.usuario._id,this.wsService.idSocket).subscribe(t=>{if(console.log(t),t.ok){this.waitForClient=!0,this.message="",this.ticket=t.ticket,this.ticketsService.myTicket=t.ticket,localStorage.setItem("ticket",JSON.stringify(t.ticket)),this.tmWaiting=this.ticketsService.getTimeInterval(t.ticket.tm_start,t.ticket.tm_att);const e=this.wsService.escucharEnCamino(),i=b(1e3).pipe(Object(d.a)(t=>t+1),Object(l.a)(10));let s=!1;i.pipe(Object(u.a)(t=>this.timerCount=10-t),Object(k.a)(e)).subscribe(t=>{t>=9&&(s=!0)},void 0,()=>{new Promise(t=>{s?(this.waitForClient=!1,this.comingClient=!1,t()):(this.waitForClient=!0,this.comingClient=!0,b(1e3).pipe(Object(d.a)(t=>t+1),Object(l.a)(20)).subscribe(t=>this.timerCount=20-t,void 0,()=>{this.waitForClient=!1,this.comingClient=!1,t()}))}).then(()=>{const t=b(1e3),e=(new Date).getTime(),i=t.subscribe(()=>{this.ticket?this.tmAttention=this.ticketsService.getTimeInterval(e,+new Date):i.unsubscribe()})})})}else this.waitForClient=!1,this.message=t.msg,this.clearSession()})}atenderInformes(){}devolverTicket(){this.clearSession(),this.ticketsService.devolverTicket(this.cdDesk).subscribe(t=>{this.message=t.msg})}finalizarTicket(){this.clearSession(),this.ticketsService.finalizarTicket(this.cdDesk).subscribe(t=>{this.message=t.msg})}clearSession(){this.ticket=null,this.ticketsService.myTicket=null,localStorage.getItem("ticket")&&localStorage.removeItem("ticket"),this.ticketsService.chatMessages=[],this.tmWaiting="--:--:--",this.tmAttention="--:--:--"}}return t.\u0275fac=function(e){return new(e||t)(v.Lb(c.a),v.Lb(h.a),v.Lb(p.a),v.Lb(m.a),v.Lb(g.a))},t.\u0275cmp=v.Fb({type:t,selectors:[["app-desktop"]],decls:52,vars:13,consts:[[1,"m-4","row","animated","fadeIn"],[1,"col-lg-6"],[1,"card","text-white","bg-danger","mb-4"],[1,"card-header","banner-title"],[4,"ngIf"],[1,"banner-content",2,"background-color","rgb(141, 51, 51)"],[1,"container"],["class","my-4",4,"ngIf"],["class","card bg-danger text-white my-4 py-2",4,"ngIf"],[1,"row","banner-footer"],[1,"col","p-0"],[1,"row","py-2"],[1,"my-2","col-md-6","col-sm-12"],[1,"btn","btn-info","btn-block","btn-lg",3,"disabled","click"],[1,"btn","btn-success","btn-block","btn-lg",3,"disabled","click"],[1,"btn","btn-primary","btn-block","btn-lg",3,"disabled","click"],[1,"btn","btn-danger","btn-block","btn-lg",3,"disabled","click"],[2,"float","right","color","yellow","font-size","x-large"],[1,"row"],[1,"col"],[1,"col","xxxxl"],[1,"my-4"],[1,"card","bg-danger","text-white","my-4","py-2"]],template:function(t,e){1&t&&(v.Qb(0,"div",0),v.Qb(1,"div",1),v.Qb(2,"div",2),v.Qb(3,"div",3),v.Qb(4,"span"),v.rc(5),v.Pb(),v.qc(6,P,3,0,"span",4),v.Pb(),v.Qb(7,"div",5),v.Qb(8,"div",6),v.qc(9,Q,7,1,"div",4),v.qc(10,y,2,1,"div",7),v.qc(11,w,2,1,"div",8),v.Qb(12,"div",9),v.Qb(13,"div",10),v.Qb(14,"div"),v.rc(15,"TE"),v.Pb(),v.Qb(16,"div"),v.rc(17),v.Pb(),v.Pb(),v.Qb(18,"div",10),v.Qb(19,"div"),v.rc(20,"TA"),v.Pb(),v.Qb(21,"div"),v.rc(22),v.Pb(),v.Pb(),v.Qb(23,"div",10),v.Qb(24,"div"),v.rc(25,"Tm"),v.Pb(),v.Qb(26,"div"),v.rc(27),v.Pb(),v.Pb(),v.Qb(28,"div",10),v.Qb(29,"div"),v.rc(30,"TC"),v.Pb(),v.Qb(31,"div"),v.rc(32),v.Pb(),v.Pb(),v.Pb(),v.Pb(),v.Pb(),v.Pb(),v.Pb(),v.Qb(33,"div",1),v.Qb(34,"div",2),v.Qb(35,"div",3),v.rc(36," Panel "),v.Pb(),v.Qb(37,"div",5),v.Qb(38,"div",6),v.Qb(39,"div",11),v.Qb(40,"div",12),v.Qb(41,"button",13),v.Xb("click",(function(){return e.atenderInformes()})),v.rc(42," Informes "),v.Pb(),v.Pb(),v.Qb(43,"div",12),v.Qb(44,"button",14),v.Xb("click",(function(){return e.atenderTicket()})),v.rc(45," Siguiente "),v.Pb(),v.Pb(),v.Qb(46,"div",12),v.Qb(47,"button",15),v.Xb("click",(function(){return e.devolverTicket()})),v.rc(48," Devolver "),v.Pb(),v.Pb(),v.Qb(49,"div",12),v.Qb(50,"button",16),v.Xb("click",(function(){return e.finalizarTicket()})),v.rc(51," Finalizar "),v.Pb(),v.Pb(),v.Pb(),v.Pb(),v.Pb(),v.Pb(),v.Pb(),v.Pb()),2&t&&(v.zb(5),v.tc(" ESCRITORIO ",e.cdDesk," "),v.zb(1),v.ec("ngIf",e.comingClient),v.zb(3),v.ec("ngIf",e.ticket),v.zb(1),v.ec("ngIf",!e.ticket),v.zb(1),v.ec("ngIf",e.message),v.zb(6),v.sc(e.tmWaiting),v.zb(5),v.sc(e.tmAttention),v.zb(5),v.sc(e.timerCount),v.zb(5),v.sc(e.pendingTickets),v.zb(9),v.ec("disabled",e.waitForClient),v.zb(3),v.ec("disabled",e.waitForClient),v.zb(3),v.ec("disabled",e.waitForClient),v.zb(3),v.ec("disabled",e.waitForClient))},directives:[s.j,f.a],styles:[""]}),t})();var z=i("AIE+"),T=i("Q2Ze"),D=i("ZTz/"),C=i("UhP/");function F(t,e){if(1&t&&(v.Qb(0,"mat-option",11),v.rc(1),v.Pb()),2&t){const t=e.$implicit;v.ec("value",t),v.zb(1),v.sc(t.cd_desktop)}}function O(t,e){if(1&t){const t=v.Rb();v.Qb(0,"div",4),v.Qb(1,"mat-form-field",6),v.Qb(2,"mat-label"),v.rc(3,"Seleccione"),v.Pb(),v.Qb(4,"mat-select",7,8),v.qc(6,F,2,2,"mat-option",9),v.Pb(),v.Pb(),v.Qb(7,"div"),v.Qb(8,"button",10),v.Xb("click",(function(){v.kc(t);const e=v.jc(5);return v.Zb().entrar(null==e?null:e.value)})),v.rc(9,"Ingresar"),v.Pb(),v.Pb(),v.Pb()}if(2&t){const t=v.Zb();v.zb(6),v.ec("ngForOf",t.desktopsAvailable)}}function _(t,e){if(1&t){const t=v.Rb();v.Qb(0,"div",4),v.rc(1),v.Qb(2,"div"),v.Qb(3,"button",12),v.Xb("click",(function(){v.kc(t);const e=v.Zb();return e.entrar(e.myDesktop)})),v.rc(4,"Ingresar"),v.Pb(),v.Qb(5,"button",13),v.Xb("click",(function(){v.kc(t);const e=v.Zb();return e.finalizar(e.myDesktop)})),v.rc(6,"Finalizar"),v.Pb(),v.Pb(),v.Pb()}if(2&t){const t=v.Zb();v.zb(1),v.tc(" Usted tiene tomado el escritorio ",t.myDesktop.cd_desktop," ")}}function q(t,e){if(1&t&&(v.Qb(0,"div"),v.rc(1),v.Pb()),2&t){const t=e.$implicit;v.zb(1),v.uc(" ",t.cd_desktop," tomado por ",t.id_assistant," ")}}function j(t,e){if(1&t&&(v.Qb(0,"div",4),v.rc(1," Todos los escritorios estan tomados. "),v.qc(2,q,2,2,"div",14),v.Pb()),2&t){const t=v.Zb();v.zb(2),v.ec("ngForOf",t.desktops)}}const A=[{path:"home",component:(()=>{class t{constructor(t,e,i){this.router=t,this.userService=e,this.snack=i,this.desktops=[],this.desktopsAvailable=[]}ngOnInit(){this.obtenerEscritorios()}entrar(t){t&&this.userService.takeDesktop(this.userService.usuario.id_company,t._id,this.userService.usuario._id).subscribe(e=>{this.snack.open(e.msg,null,{duration:2e3}),e.ok?(this.userService.desktop=e.desktop,localStorage.setItem("desktop",JSON.stringify(e.desktop)),this.router.navigate(["/asistente/escritorio",t.cd_desktop])):this.snack.open("No se pudo tomar un escritorio",null,{duration:2e3})})}obtenerEscritorios(){this.userService.readDesktops(this.userService.usuario.id_company).subscribe(t=>{this.desktops=t.desktops,this.desktopsAvailable=this.desktops.filter(t=>null===t.id_assistant),this.myDesktop=this.desktops.filter(t=>t.id_assistant===this.userService.usuario._id)[0],this.myDesktop?(this.userService.desktop=this.myDesktop,localStorage.setItem("desktop",JSON.stringify(this.myDesktop))):(this.userService.desktop=null,localStorage.getItem("desktop")&&localStorage.removeItem("desktop"))})}finalizar(t){this.userService.releaseDesktop(t).subscribe(t=>{this.obtenerEscritorios()})}}return t.\u0275fac=function(e){return new(e||t)(v.Lb(c.b),v.Lb(p.a),v.Lb(g.a))},t.\u0275cmp=v.Fb({type:t,selectors:[["app-home"]],decls:13,vars:3,consts:[[1,"jumbotron","m-4","animated","fadeIn"],[1,"display-4"],[1,"lead"],["class","my-4",4,"ngIf"],[1,"my-4"],["routerLink","/asistente/dashboard","role","button",1,"btn","btn-primary","btn-lg"],["appearance","fill"],["matNativeControl","","required",""],["selectDesktop",""],[3,"value",4,"ngFor","ngForOf"],["role","button",1,"btn","btn-success",3,"click"],[3,"value"],["role","button",1,"btn","btn-success","m-1",3,"click"],["role","button",1,"btn","btn-danger","m-1",3,"click"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(v.Qb(0,"div",0),v.Qb(1,"h1",1),v.rc(2,"Bienvenido a la web del asistente"),v.Pb(),v.Qb(3,"p",2),v.rc(4,"Bienvenido, desde aqu\xed puede sacar un turno y evitar la sala de esperas."),v.Pb(),v.qc(5,O,10,1,"div",3),v.qc(6,_,7,1,"div",3),v.qc(7,j,3,1,"div",3),v.Mb(8,"hr",4),v.Qb(9,"p"),v.rc(10," Desde ac\xe1 podes ingresar a una ventanilla de atenci\xf3n. Desde el chat podra ver las consultas de los clientes una vez se les haya asignado esta ventanilla. Si desea puede tambi\xe9n atender consultas desde la ventanilla de informes para todas las consultas que todav\xeda permanecen en espera. "),v.Pb(),v.Qb(11,"a",5),v.rc(12,"Dashboard"),v.Pb(),v.Pb()),2&t&&(v.zb(5),v.ec("ngIf",!e.myDesktop),v.zb(1),v.ec("ngIf",e.myDesktop),v.zb(1),v.ec("ngIf",0===e.desktopsAvailable.length))},directives:[s.j,c.d,T.b,T.e,D.a,s.i,C.h],styles:[""]}),t})()},{path:"escritorio/:id",component:I},{path:"dashboard",component:(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=v.Fb({type:t,selectors:[["app-dashboard"]],decls:4,vars:0,consts:[[1,"container","animated","fadeIn"],[1,"row"],[1,"col"]],template:function(t,e){1&t&&(v.Qb(0,"div",0),v.Qb(1,"div",1),v.Qb(2,"div",2),v.rc(3," Dashboard "),v.Pb(),v.Pb(),v.Pb())},styles:[""]}),t})()},{path:"",redirectTo:"/asistente/home",pathMatch:"full"},{path:"**",component:z.a}];let Z=(()=>{class t{}return t.\u0275mod=v.Jb({type:t}),t.\u0275inj=v.Ib({factory:function(e){return new(e||t)},imports:[[c.e.forChild(A)],c.e]}),t})();var x=i("1+r1");let J=(()=>{class t{}return t.\u0275mod=v.Jb({type:t}),t.\u0275inj=v.Ib({factory:function(e){return new(e||t)},imports:[[s.b,x.a,Z]]}),t})()}}]);
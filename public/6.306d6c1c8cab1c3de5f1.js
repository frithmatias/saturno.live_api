(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{w8Di:function(t,i,e){"use strict";e.r(i),e.d(i,"AssistantModule",(function(){return ht}));var s=e("SVse"),n=e("iInd"),c=e("mrSG"),a=e("XNiG"),o=e("l5mm"),r=e("lJxs"),d=e("IzEk"),b=e("vkgz"),l=e("1G5W"),u=e("8Y7J"),v=e("EFyh"),h=e("kWJr"),g=e("Gyf/"),S=e("zHaW"),m=e("jMqV"),k=e("s7LF"),p=e("pu8Q"),f=e("zQhy");function R(t,i){1&t&&(u.Sb(0,"div",17),u.Nb(1,"mat-spinner"),u.Rb())}function w(t,i){1&t&&(u.Sb(0,"span"),u.Nb(1,"span",36),u.Rb())}function y(t,i){if(1&t&&(u.Sb(0,"div"),u.Sb(1,"div"),u.wc(2," Atendiendo turno "),u.Rb(),u.Sb(3,"div",37),u.Sb(4,"div",38),u.wc(5),u.Rb(),u.Rb(),u.Rb()),2&t){const t=u.dc(2);u.Ab(5),u.zc(" ",null==t.assistantService.ticket.id_skill?null:t.assistantService.ticket.id_skill.cd_skill," ",t.assistantService.ticket.id_position," ")}}function _(t,i){if(1&t&&(u.Sb(0,"div",39),u.wc(1),u.Rb()),2&t){const t=u.dc(2);u.Ab(1),u.xc(t.message)}}const A=function(){return["/admin/assistants"]};function x(t,i){1&t&&(u.Sb(0,"div",40),u.Sb(1,"p"),u.wc(2," Usted no tiene habilidades asignadas. Debe ir al administrador de asistentes, luego seleccionar el asistente y all\xed asignarle skills / habilidades. "),u.Sb(3,"button",41),u.wc(4,"ADMINISTRADOR DE ASISTENTES"),u.Rb(),u.Rb(),u.Rb()),2&t&&(u.Ab(3),u.jc("routerLink",u.lc(1,A)))}function T(t,i){1&t&&u.Nb(0,"span",46)}function I(t,i){if(1&t&&(u.Sb(0,"span"),u.Nb(1,"mat-radio-button",47),u.Rb()),2&t){const t=u.dc().$implicit;u.Ab(1),u.jc("value",t.id)}}function j(t,i){if(1&t&&(u.Sb(0,"tr"),u.Sb(1,"td",42),u.vc(2,T,1,0,"span",43),u.vc(3,I,2,1,"span",21),u.Rb(),u.Sb(4,"td",44),u.wc(5),u.Rb(),u.Sb(6,"td",45),u.wc(7),u.Rb(),u.Rb()),2&t){const t=i.$implicit,e=u.dc(2);u.Ab(2),u.jc("ngIf",t.assigned),u.Ab(1),u.jc("ngIf",!t.assigned&&!e.waitForClient&&e.assistantService.ticket),u.Ab(2),u.yc(" ",t.tx_skill," "),u.Ab(2),u.yc(" ",t.tickets.length," ")}}function C(t,i){if(1&t){const t=u.Tb();u.Sb(0,"div",18),u.Sb(1,"div",19),u.Sb(2,"div",20),u.Sb(3,"span"),u.wc(4),u.Rb(),u.vc(5,w,2,0,"span",21),u.Rb(),u.Sb(6,"div",22),u.Sb(7,"div",23),u.vc(8,y,6,2,"div",21),u.vc(9,_,2,1,"div",24),u.Rb(),u.Rb(),u.Sb(10,"div",25),u.Sb(11,"div",4),u.Sb(12,"div",26),u.Sb(13,"div"),u.wc(14,"TE"),u.Rb(),u.Sb(15,"div"),u.wc(16),u.Rb(),u.Rb(),u.Sb(17,"div",26),u.Sb(18,"div"),u.wc(19,"TA"),u.Rb(),u.Sb(20,"div"),u.wc(21),u.Rb(),u.Rb(),u.Sb(22,"div",26),u.Sb(23,"div"),u.wc(24,"Tm"),u.Rb(),u.Sb(25,"div"),u.wc(26),u.Rb(),u.Rb(),u.Sb(27,"div",26),u.Sb(28,"div"),u.wc(29,"TC"),u.Rb(),u.Sb(30,"div"),u.wc(31),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.vc(32,x,5,2,"div",27),u.Sb(33,"div",28),u.Sb(34,"div",29),u.Sb(35,"mat-radio-group",30),u.Zb("ngModelChange",(function(i){return u.pc(t),u.dc().skillSelected=i})),u.Sb(36,"table",31),u.Sb(37,"tr",32),u.Nb(38,"td",33),u.Sb(39,"td",33),u.wc(40,"Skill"),u.Rb(),u.Sb(41,"td",34),u.wc(42," En espera "),u.Rb(),u.Rb(),u.vc(43,j,8,4,"tr",35),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb()}if(2&t){const t=u.dc();u.Ab(4),u.yc(" ESCRITORIO ",null==t.assistantService.desktop?null:t.assistantService.desktop.cd_desktop," "),u.Ab(1),u.jc("ngIf",t.comingClient),u.Ab(3),u.jc("ngIf",t.assistantService.ticket),u.Ab(1),u.jc("ngIf",t.message),u.Ab(7),u.xc(t.tmWaitingStr),u.Ab(5),u.xc(t.tmAttention),u.Ab(5),u.xc(t.timerCount),u.Ab(5),u.xc(t.pendingTicketsCount),u.Ab(1),u.jc("ngIf",0===t.skillsAssistantThisCompany.length),u.Ab(3),u.jc("ngModel",t.skillSelected),u.Ab(8),u.jc("ngForOf",t.pendingTicketsBySkill)}}const D=function(t){return{"button-disabled":t}};let F=(()=>{class t{constructor(t,i,e,s,n){this.loginService=t,this.assistantService=i,this.wsService=e,this.snack=s,this.router=n,this.loading=!1,this.waitForClient=!1,this.comingClient=!1,this.pendingTicketsCount=0,this.pendingTicketsBySkill=[],this.timerCount=2,this.tmWaitingStr="--:--:--",this.tmAttention="--:--:--",this.message="",this.skills=[],this.skillsAssistantThisCompany=[],this.skillSelected="",this.blPriority=!1,this.subjectUpdateTickets$=new a.a,this.subjectTurnoCancelado$=new a.a}ngOnInit(){return Object(c.a)(this,void 0,void 0,(function*(){this.loading=!0,this.assistantService.desktop?(yield this.readSkills().then(t=>{this.skills=t}).catch(()=>{this.snack.open("Error al obtener los skills",null,{duration:2e3})}),yield this.getTickets(),this.wsService.escucharUpdateDesktops().subscribe(this.subjectUpdateTickets$),this.subjectUpdateTickets$.subscribe(()=>{this.getTickets()}),this.wsService.escucharTicketCancelled().subscribe(this.subjectTurnoCancelado$),this.subjectTurnoCancelado$.subscribe(t=>{var i;t===(null===(i=this.assistantService.ticket)||void 0===i?void 0:i._id)&&(this.snack.open("El turno fue cancelado por el cliente",null,{duration:1e4}),this.clearDesktopSession(),this.getTickets())}),this.loading=!1):this.router.navigate(["/assistant/home"])}))}getTickets(){var t;return Object(c.a)(this,void 0,void 0,(function*(){let i=null===(t=this.loginService.user.id_company)||void 0===t?void 0:t._id;return this.assistantService.getTickets(i).subscribe(t=>{const i=t.tickets.filter(t=>{var i,e;return(null===(i=t.id_session)||void 0===i?void 0:i.id_desktop._id)===this.assistantService.desktop.id_session.id_desktop._id&&void 0!==(null===(e=t.id_session)||void 0===e?void 0:e.id_desktop._id)&&null!==t.tm_att&&null===t.tm_end&&null===t.id_child})[0];i?(this.message="Existe un ticket pendiente de resoluci\xf3n",this.assistantService.ticket=i,localStorage.setItem("ticket",JSON.stringify(i))):this.assistantService.ticket=null;let e=this.skills,s=[];this.loginService.user.id_skills.forEach(t=>s.push(t._id));const n=t.tickets.filter(t=>{var i;return null===t.tm_end&&s.includes(null===(i=t.id_skill)||void 0===i?void 0:i._id)}),c=t.tickets.filter(t=>null===t.tm_end);this.pendingTicketsCount=n.length,this.message=n.length>0?`Hay ${n.length} tickets en espera`:"No existen tickets pendientes.",this.pendingTicketsBySkill=[];for(let a of e)s.includes(a._id)&&this.skillsAssistantThisCompany.push(a),this.pendingTicketsBySkill.push({id:a._id,assigned:s.includes(a._id),cd_skill:a.cd_skill,tx_skill:a.tx_skill,tickets:c.filter(t=>{var i;return(null===(i=t.id_skill)||void 0===i?void 0:i._id)===a._id&&null===t.tm_end})});this.loading=!1})}))}clearDesktopSession(){this.assistantService.ticket=null,this.assistantService.chatMessages=[],localStorage.getItem("ticket")&&localStorage.removeItem("ticket"),this.tmWaitingStr="--:--:--",this.tmAttention="--:--:--",this.timerCount=2,this.waitForClient=!1,this.tmWaitingSub&&this.tmWaitingSub.unsubscribe(),this.tmExtraTimeSub&&this.tmExtraTimeSub.unsubscribe(),this.tmRunSub&&this.tmRunSub.unsubscribe(),this.getTickets()}releaseDesktop(){return Object(c.a)(this,void 0,void 0,(function*(){if(this.assistantService.ticket){let t="Tiene una sesi\xf3n de turno activa. \xbfDesea finalizarla?";return yield this.askForContinue(t).then(()=>{this.assistantService.endTicket(this.assistantService.ticket._id).subscribe(t=>{t.ok&&this.assistantService.releaseDesktop(this.assistantService.ticket._id).subscribe(i=>{i.ok?this.router.navigate(["assistant/home"]):this.message=t.msg})})}).catch(()=>{})}this.assistantService.releaseDesktop(this.assistantService.desktop._id).subscribe(t=>{t.ok&&(this.clearDesktopSession(),this.router.navigate(["assistant/home"]))})}))}readSkills(){return new Promise((t,i)=>{var e;let s=null===(e=this.loginService.user.id_company)||void 0===e?void 0:e._id;this.assistantService.readSkills(s).subscribe(e=>{e.ok?t(e.skills):i([])})})}askForContinue(t){return new Promise((i,e)=>{this.snack.open(t,"ACEPTAR",{duration:5e3}).afterDismissed().subscribe(t=>{t.dismissedByAction?i():e()})})}takeTicket(){return Object(c.a)(this,void 0,void 0,(function*(){this.assistantService.ticket||this.assistantService.takeTicket(this.assistantService.desktop.id_session._id,this.wsService.idSocket).subscribe(t=>{if(this.snack.open(t.msg,null,{duration:2e3}),t.ok){this.waitForClient=!0,this.message="",this.assistantService.ticket=t.ticket,localStorage.setItem("ticket",JSON.stringify(t.ticket)),this.tmWaitingStr=this.assistantService.getTimeInterval(t.ticket.tm_start,t.ticket.tm_att);const i=this.wsService.escucharEnCamino(),e=Object(o.a)(1e3).pipe(Object(r.a)(t=>t+1),Object(d.a)(2));let s=!1;this.tmWaitingSub=e.pipe(Object(b.a)(t=>this.timerCount=2-t),Object(l.a)(i)).subscribe(t=>{t>=1&&(s=!0)},void 0,()=>{new Promise(t=>{if(s)this.waitForClient=!1,this.comingClient=!1,t();else{this.waitForClient=!0,this.comingClient=!0;const i=Object(o.a)(1e3).pipe(Object(r.a)(t=>t+1),Object(d.a)(5));this.tmExtraTimeSub=i.subscribe(t=>this.timerCount=5-t,void 0,()=>{this.waitForClient=!1,this.comingClient=!1,t()})}}).then(()=>{const t=Object(o.a)(1e3),i=(new Date).getTime();this.tmRunSub=t.subscribe(t=>{this.tmAttention=this.assistantService.getTimeInterval(i,+new Date)})})})}else this.waitForClient=!1,this.message=t.msg}),this.getTickets()}))}releaseTicket(){return Object(c.a)(this,void 0,void 0,(function*(){if(this.assistantService.ticket){let t="Desea soltar el ticket y devolverlo a su estado anterior?";yield this.askForContinue(t).then(()=>{this.assistantService.releaseTicket(this.assistantService.ticket._id).subscribe(t=>{t.ok&&(this.clearDesktopSession(),this.message=t.msg)})}).catch(()=>{})}}))}reassignTicket(){return Object(c.a)(this,void 0,void 0,(function*(){if(this.assistantService.ticket){let t="Desea enviar el ticket al skill seleccionado?";yield this.askForContinue(t).then(()=>{var t;let i=null===(t=this.assistantService.ticket)||void 0===t?void 0:t._id,e=this.skillSelected;i&&e&&this.assistantService.reassignTicket(i,e,this.blPriority).subscribe(t=>{t.ok&&(this.blPriority=!1,this.clearDesktopSession(),this.message=t.msg)})}).catch(()=>{})}}))}endTicket(){return Object(c.a)(this,void 0,void 0,(function*(){if(this.assistantService.ticket){let t="Desea finalizar el ticket actual?";yield this.askForContinue(t).then(()=>{this.assistantService.endTicket(this.assistantService.ticket._id).subscribe(t=>{t.ok&&(this.clearDesktopSession(),this.message=t.msg)})}).catch(()=>{})}}))}ngOnDestroy(){this.subjectUpdateTickets$.complete(),this.subjectTurnoCancelado$.complete()}}return t.\u0275fac=function(i){return new(i||t)(u.Mb(v.a),u.Mb(h.a),u.Mb(g.a),u.Mb(S.a),u.Mb(n.b))},t.\u0275cmp=u.Gb({type:t,selectors:[["app-desktop"]],decls:38,vars:24,consts:[[1,"saturno-container","shadow-box","animated","fadeIn",2,"padding-bottom","3em"],["class","mt-5 animated fadeIn",4,"ngIf"],["class","animated fadeIn",4,"ngIf"],[1,"container","bg-light","fixed-bottom","shadow-box","no-radius","text-center","py-1"],[1,"row"],[1,"col-4","col-sm-2","button-content"],[1,"mx-2","my-1",3,"ngModel","disabled","ngModelChange"],[1,"mdi","mdi-human-wheelchair","xl","mx-1"],[1,"btn","btn-success","button",3,"ngClass","disabled","click"],[1,"mdi","mdi-list-status","xl"],[1,"button-inner"],[1,"btn","btn-success","button",3,"disabled","ngClass","click"],[1,"mdi","mdi-chevron-right","xl"],[1,"mdi","mdi-replay","xl"],[1,"mdi","mdi-close","xl"],[1,"btn","btn-danger","button",3,"disabled","ngClass","click"],[1,"mdi","mdi-power","xl"],[1,"mt-5","animated","fadeIn"],[1,"animated","fadeIn"],[1,"card","bg-light","mb-4"],[1,"card-header","banner-title"],[4,"ngIf"],[1,"card-body"],[1,"container"],["class","card text-white my-4 p-1","style","background-color: darkcyan;",4,"ngIf"],[1,"card-footer"],[1,"col","p-0"],["class","saturno-container card bg-danger text-white p-3 mb-4",4,"ngIf"],[1,"saturno-container","card","bg-secondary","mb-4"],[1,"card-content","table-responsive-sm","p-2"],[3,"ngModel","ngModelChange"],[1,"table","table-sm","text-white","text-center"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[2,"text-align","right","border","none"],[4,"ngFor","ngForOf"],[1,"mdi","mdi-walk",2,"float","right","color","green","font-size","x-large"],[1,"banner-content","xxxxl"],[1,"xxxl"],[1,"card","text-white","my-4","p-1",2,"background-color","darkcyan"],[1,"saturno-container","card","bg-danger","text-white","p-3","mb-4"],[1,"btn","btn-danger","btn-block","btn-sm","my-2",3,"routerLink"],[2,"padding","0","vertical-align","middle","font-size","16px"],["class","mdi mdi-check","style","color: greenyellow",4,"ngIf"],[2,"text-align","left"],[2,"text-align","right"],[1,"mdi","mdi-check",2,"color","greenyellow"],[2,"position","relative","left","4px","top","4px",3,"value"]],template:function(t,i){1&t&&(u.Sb(0,"div",0),u.vc(1,R,2,0,"div",1),u.vc(2,C,44,11,"div",2),u.Rb(),u.Sb(3,"div",3),u.Sb(4,"div",4),u.Sb(5,"div",5),u.Sb(6,"mat-slide-toggle",6),u.Zb("ngModelChange",(function(t){return i.blPriority=t})),u.Nb(7,"span",7),u.Rb(),u.Rb(),u.Sb(8,"div",5),u.Sb(9,"button",8),u.Zb("click",(function(){return i.reassignTicket()})),u.Sb(10,"div"),u.Nb(11,"div",9),u.Rb(),u.Sb(12,"div",10),u.wc(13," Asignar "),u.Rb(),u.Rb(),u.Rb(),u.Sb(14,"div",5),u.Sb(15,"button",11),u.Zb("click",(function(){return i.takeTicket()})),u.Sb(16,"div"),u.Nb(17,"div",12),u.Rb(),u.Sb(18,"div",10),u.wc(19," Siguiente "),u.Rb(),u.Rb(),u.Rb(),u.Sb(20,"div",5),u.Sb(21,"button",11),u.Zb("click",(function(){return i.releaseTicket()})),u.Sb(22,"div"),u.Nb(23,"div",13),u.Rb(),u.Sb(24,"div",10),u.wc(25," Soltar "),u.Rb(),u.Rb(),u.Rb(),u.Sb(26,"div",5),u.Sb(27,"button",11),u.Zb("click",(function(){return i.endTicket()})),u.Sb(28,"div"),u.Nb(29,"div",14),u.Rb(),u.Sb(30,"div",10),u.wc(31," Finalizar "),u.Rb(),u.Rb(),u.Rb(),u.Sb(32,"div",5),u.Sb(33,"button",15),u.Zb("click",(function(){return i.releaseDesktop()})),u.Sb(34,"div"),u.Nb(35,"div",16),u.Rb(),u.Sb(36,"div",10),u.wc(37," Salir "),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb()),2&t&&(u.Ab(1),u.jc("ngIf",i.loading),u.Ab(1),u.jc("ngIf",!i.loading),u.Ab(4),u.jc("ngModel",i.blPriority)("disabled",i.waitForClient||!i.assistantService.ticket||""===i.skillSelected),u.Ab(3),u.jc("ngClass",u.mc(14,D,i.waitForClient||!i.assistantService.ticket||""===i.skillSelected))("disabled",i.waitForClient||!i.assistantService.ticket||""===i.skillSelected),u.Ab(6),u.jc("disabled",i.waitForClient||i.assistantService.ticket)("ngClass",u.mc(16,D,i.waitForClient||i.assistantService.ticket)),u.Ab(6),u.jc("disabled",i.waitForClient||!i.assistantService.ticket)("ngClass",u.mc(18,D,i.waitForClient||!i.assistantService.ticket)),u.Ab(6),u.jc("disabled",i.waitForClient||!i.assistantService.ticket)("ngClass",u.mc(20,D,i.waitForClient||!i.assistantService.ticket)),u.Ab(6),u.jc("disabled",i.waitForClient)("ngClass",u.mc(22,D,i.waitForClient)))},directives:[s.j,m.a,k.o,k.r,s.h,p.b,f.b,s.i,n.c,f.a],styles:[".button-disabled[_ngcontent-%COMP%]{background-color:#f1f1f1;color:#c7c7c7}"]}),t})();var O=e("AIE+"),M=e("zuHl"),N=e("Q2Ze"),E=e("ZTz/"),z=e("UhP/");function $(t,i){1&t&&(u.Sb(0,"div",4),u.Nb(1,"mat-spinner"),u.Rb())}function W(t,i){1&t&&(u.Sb(0,"div",8),u.wc(1," No tiene asignada ning\xfana empresa. Debe seleccionarla desde el men\xfa prinicipal. "),u.Rb())}function Z(t,i){1&t&&(u.Sb(0,"div",8),u.wc(1," No tiene escritorios creados. Debe darlos de alta desde el Men\xfa de Administrador. "),u.Rb())}function H(t,i){if(1&t){const t=u.Tb();u.Sb(0,"div",2),u.wc(1),u.Sb(2,"div"),u.Sb(3,"button",17),u.Zb("click",(function(){u.pc(t);const i=u.dc(3);return i.takeDesktop(i.myDesktop)})),u.wc(4,"Ingresar"),u.Rb(),u.Sb(5,"button",18),u.Zb("click",(function(){u.pc(t);const i=u.dc(3);return i.releaseDesktop(i.myDesktop)})),u.wc(6,"Finalizar"),u.Rb(),u.Rb(),u.Rb()}if(2&t){const t=u.dc(3);u.Ab(1),u.yc(" Usted tiene tomado el escritorio ",t.myDesktop.cd_desktop," ")}}function U(t,i){1&t&&(u.Sb(0,"div",20),u.wc(1," Todos los escritorios estan tomados. "),u.Rb())}function J(t,i){if(1&t&&(u.Sb(0,"mat-option",26),u.wc(1),u.Rb()),2&t){const t=i.$implicit;u.jc("value",t),u.Ab(1),u.yc(" ",t.cd_desktop," ")}}function P(t,i){if(1&t){const t=u.Tb();u.Sb(0,"div",2),u.Sb(1,"mat-form-field",21),u.Sb(2,"mat-label"),u.wc(3,"Seleccione un escritorio"),u.Rb(),u.Sb(4,"mat-select",22,23),u.vc(6,J,2,2,"mat-option",24),u.Rb(),u.Rb(),u.Sb(7,"button",25),u.Zb("click",(function(){u.pc(t);const i=u.oc(5);return u.dc(4).takeDesktop(null==i?null:i.value)})),u.wc(8," Ingresar "),u.Rb(),u.Rb()}if(2&t){const t=u.dc(4);u.Ab(6),u.jc("ngForOf",t.desktopsAvailable)}}function G(t,i){if(1&t&&(u.Sb(0,"div",2),u.vc(1,U,2,0,"div",19),u.vc(2,P,9,1,"div",9),u.Rb()),2&t){const t=u.dc(3);u.Ab(1),u.jc("ngIf",0===t.desktopsAvailable.length),u.Ab(1),u.jc("ngIf",t.desktopsAvailable.length>0)}}function B(t,i){if(1&t&&(u.Sb(0,"div"),u.wc(1),u.Rb()),2&t){const t=u.dc().$implicit;u.Ab(1),u.yc(" ",null==t.id_session?null:t.id_session.id_assistant.tx_name," ")}}function L(t,i){1&t&&(u.Sb(0,"div",30),u.wc(1," Disponible "),u.Rb())}function q(t,i){if(1&t&&(u.Sb(0,"tr"),u.Sb(1,"td",27),u.wc(2),u.Rb(),u.Sb(3,"td",28),u.vc(4,B,2,1,"div",7),u.vc(5,L,2,0,"div",29),u.Rb(),u.Rb()),2&t){const t=i.$implicit;u.Ab(2),u.yc(" ",t.cd_desktop," "),u.Ab(2),u.jc("ngIf",t.id_session),u.Ab(1),u.jc("ngIf",!t.id_session)}}function Q(t,i){if(1&t&&(u.Sb(0,"div"),u.vc(1,H,7,1,"div",9),u.vc(2,G,3,2,"div",9),u.Sb(3,"div",10),u.Sb(4,"div",11),u.Sb(5,"table",12),u.Sb(6,"tr",13),u.Sb(7,"td",14),u.wc(8," Escritorio "),u.Rb(),u.Sb(9,"td",15),u.wc(10," Asistente "),u.Rb(),u.Rb(),u.vc(11,q,6,3,"tr",16),u.Rb(),u.Rb(),u.Rb(),u.Rb()),2&t){const t=u.dc(2);u.Ab(1),u.jc("ngIf",t.myDesktop),u.Ab(1),u.jc("ngIf",!t.myDesktop),u.Ab(9),u.jc("ngForOf",t.desktops)}}function K(t,i){if(1&t&&(u.Sb(0,"div",4),u.Sb(1,"p",5),u.wc(2,"Bienvenido, desde aqu\xed puede tomar escritorios y atender turnos."),u.Rb(),u.vc(3,W,2,0,"div",6),u.vc(4,Z,2,0,"div",6),u.vc(5,Q,12,3,"div",7),u.Rb()),2&t){const t=u.dc();u.Ab(3),u.jc("ngIf",!t.loginService.user.id_company),u.Ab(1),u.jc("ngIf",0===(null==t.desktops?null:t.desktops.length)),u.Ab(1),u.jc("ngIf",(null==t.desktops?null:t.desktops.length)>0&&(null==t.loginService.user.id_company?null:t.loginService.user.id_company._id))}}let V=(()=>{class t{constructor(t,i,e,s,n){this.router=t,this.loginService=i,this.assistantService=e,this.sharedService=s,this.snack=n,this.loading=!1,this.desktops=[],this.desktopsAvailable=[]}ngOnInit(){var t;if(this.loading=!0,!(null===(t=this.loginService.user.id_company)||void 0===t?void 0:t._id))return this.sharedService.snackShow("No tiene una empresa seleccionada",5e3),void(this.loading=!1);this.readDesktops(this.loginService.user.id_company._id),this.userSuscription=this.loginService.user$.subscribe(t=>{t&&this.readDesktops(t.id_company._id)})}takeDesktop(t){t&&(this.assistantService.desktop?this.router.navigate(["/assistant/desktop"]):this.assistantService.takeDesktop(t._id,this.loginService.user._id).subscribe(t=>{this.snack.open(t.msg,null,{duration:2e3}),t.ok?(this.assistantService.desktop=t.desktop,localStorage.setItem("desktop",JSON.stringify(t.desktop)),this.router.navigate(["/assistant/desktop"])):this.snack.open("No se pudo tomar un escritorio",null,{duration:2e3})}))}readDesktops(t){this.assistantService.readDesktops(t).subscribe(t=>{t.ok&&(this.desktops=t.desktops,this.desktopsAvailable=this.desktops.filter(t=>null===t.id_session),this.myDesktop=this.desktops.filter(t=>{var i;return(null===(i=t.id_session)||void 0===i?void 0:i.id_assistant._id)===this.loginService.user._id})[0]),this.myDesktop?(this.assistantService.desktop=this.myDesktop,localStorage.setItem("desktop",JSON.stringify(this.myDesktop))):(this.assistantService.desktop=null,localStorage.getItem("desktop")&&localStorage.removeItem("desktop"))},()=>{this.loading=!1},()=>{this.loading=!1})}releaseDesktop(t){this.loading=!0;let i=this.loginService.user.id_company._id;this.assistantService.releaseDesktop(t._id).subscribe(t=>{this.readDesktops(i)},()=>{this.loading=!1},()=>{this.loading=!1})}ngOnDestroy(){this.userSuscription&&this.userSuscription.unsubscribe()}}return t.\u0275fac=function(i){return new(i||t)(u.Mb(n.b),u.Mb(v.a),u.Mb(h.a),u.Mb(M.a),u.Mb(S.a))},t.\u0275cmp=u.Gb({type:t,selectors:[["app-home"]],decls:8,vars:2,consts:[[1,"saturno-container","shadow-box","animated","fadeIn","p-2"],["class","animated fadeIn",4,"ngIf"],[1,"my-4"],["routerLink","/assistant/dashboard","role","button",1,"btn","btn-primary","btn-block"],[1,"animated","fadeIn"],[1,"lead"],["class","card lead bg-danger text-white p-3 my-4","style","line-height: initial;",4,"ngIf"],[4,"ngIf"],[1,"card","lead","bg-danger","text-white","p-3","my-4",2,"line-height","initial"],["class","my-4",4,"ngIf"],[1,"card","bg-secondary","mb-4"],[1,"card-content","table-responsive-sm","p-2"],[1,"table","table-sm","text-white","text-center"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[2,"text-align","right","border","none"],[4,"ngFor","ngForOf"],["role","button",1,"btn","btn-success","btn-lg","m-1",3,"click"],["role","button",1,"btn","btn-danger","btn-lg","m-1",3,"click"],["class","card bg-danger text-white p-2 my-4",4,"ngIf"],[1,"card","bg-danger","text-white","p-2","my-4"],["appearance","fill",1,"w-100"],["matNativeControl","","required",""],["selectDesktop",""],[3,"value",4,"ngFor","ngForOf"],["role","button",1,"btn","btn-success","btn-block",3,"click"],[3,"value"],[2,"text-align","left"],[2,"text-align","right"],["style","color: mediumspringgreen;",4,"ngIf"],[2,"color","mediumspringgreen"]],template:function(t,i){1&t&&(u.Sb(0,"div",0),u.vc(1,$,2,0,"div",1),u.vc(2,K,6,3,"div",1),u.Nb(3,"hr",2),u.Sb(4,"p"),u.wc(5," Recuerde que si se ausenta del escritorio debe finalizar la sesi\xf3n del escritorio. Si usted finaliza la sesi\xf3n de user se finalizar\xe1 tambi\xe9n la sesi\xf3n del escritorio. Si la sesi\xf3n del escritorio ten\xeda asignada una sesi\xf3n de turno, este turno finalizar\xe1. "),u.Rb(),u.Sb(6,"a",3),u.wc(7,"Dashboard"),u.Rb(),u.Rb()),2&t&&(u.Ab(1),u.jc("ngIf",i.loading),u.Ab(1),u.jc("ngIf",!i.loading))},directives:[s.j,n.d,p.b,s.i,N.c,N.f,E.a,z.l],styles:[""]}),t})();var X=e("IheW"),Y=e("cxbk");let tt=(()=>{class t{constructor(t,i){this.http=t,this.loginService=i}getUserMetrics(t,i){const e=new X.c({"turnos-token":this.loginService.token});return this.http.post(Y.a.url+"/m/getusermetrics",{fcSel:t,idUser:i},{headers:e})}}return t.\u0275fac=function(i){return new(i||t)(u.Wb(X.a),u.Wb(v.a))},t.\u0275prov=u.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var it=e("e6WT"),et=e("TN/R"),st=e("wd/R"),nt=e.n(st);let ct=(()=>{class t{transform(t){return nt()(t).format("H:mm:ss")}}return t.\u0275fac=function(i){return new(i||t)},t.\u0275pipe=u.Lb({name:"timeToHms",type:t,pure:!0}),t})(),at=(()=>{class t{transform(t,i){let e=nt.a.duration(i-t),s=e.hours(),n=e.minutes(),c=e.seconds();return`${s<=9?"0"+s.toString():s.toString()}:${n<=9?"0"+n.toString():n.toString()}:${c<=9?"0"+c.toString():c.toString()}`}}return t.\u0275fac=function(i){return new(i||t)},t.\u0275pipe=u.Lb({name:"intervalToHms",type:t,pure:!0}),t})();function ot(t,i){1&t&&(u.Sb(0,"div",2),u.Nb(1,"mat-spinner"),u.Rb())}function rt(t,i){if(1&t&&(u.Sb(0,"tr"),u.Sb(1,"td",25),u.wc(2),u.Rb(),u.Sb(3,"td",26),u.wc(4),u.ec(5,"timeToHms"),u.Rb(),u.Sb(6,"td",26),u.wc(7),u.ec(8,"intervalToHms"),u.Rb(),u.Sb(9,"td",26),u.wc(10),u.ec(11,"timeToHms"),u.Rb(),u.Sb(12,"td",26),u.wc(13),u.ec(14,"intervalToHms"),u.Rb(),u.Sb(15,"td",27),u.wc(16),u.ec(17,"timeToHms"),u.Rb(),u.Rb()),2&t){const t=i.$implicit;u.Ab(2),u.zc(" ",t.id_skill.cd_skill," ",t.id_position," "),u.Ab(2),u.yc(" ",u.fc(5,7,t.tm_start)," "),u.Ab(3),u.yc(" ",u.gc(8,9,t.tm_start,t.tm_att)," "),u.Ab(3),u.yc(" ",u.fc(11,12,t.tm_att)," "),u.Ab(3),u.yc(" ",u.gc(14,14,t.tm_att,t.tm_end)," "),u.Ab(3),u.yc(" ",u.fc(17,17,t.tm_end)," ")}}function dt(t,i){if(1&t){const t=u.Tb();u.Sb(0,"div"),u.Sb(1,"div",3),u.Sb(2,"div",4),u.Sb(3,"div",5),u.Sb(4,"mat-form-field",6),u.Sb(5,"mat-label"),u.wc(6,"Angular forms"),u.Rb(),u.Sb(7,"input",7),u.Zb("dateChange",(function(i){return u.pc(t),u.dc().setDate(i)})),u.Rb(),u.Nb(8,"mat-datepicker-toggle",8),u.Nb(9,"mat-datepicker",null,9),u.Rb(),u.Rb(),u.Rb(),u.Sb(11,"div",10),u.Sb(12,"div",11),u.Sb(13,"div",12),u.Sb(14,"div",13),u.wc(15,"Turnos"),u.Rb(),u.Sb(16,"div",14),u.wc(17),u.Rb(),u.Rb(),u.Rb(),u.Sb(18,"div",11),u.Sb(19,"div",15),u.Sb(20,"div",13),u.wc(21,"Evals"),u.Rb(),u.Sb(22,"div",14),u.wc(23),u.Rb(),u.Rb(),u.Rb(),u.Sb(24,"div",11),u.Sb(25,"div",16),u.Sb(26,"div",13),u.wc(27,"Score"),u.Rb(),u.Sb(28,"div",14),u.wc(29),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Sb(30,"div",4),u.Sb(31,"div",11),u.Sb(32,"div",17),u.Sb(33,"div",18),u.Sb(34,"table",19),u.Sb(35,"tr",20),u.Sb(36,"td",21),u.wc(37,"Ticket"),u.Rb(),u.Sb(38,"td",22),u.wc(39,"Start"),u.Rb(),u.Sb(40,"td",22),u.wc(41," - "),u.Rb(),u.Sb(42,"td",22),u.wc(43,"Atteneded"),u.Rb(),u.Sb(44,"td",22),u.wc(45," - "),u.Rb(),u.Sb(46,"td",23),u.wc(47,"End"),u.Rb(),u.Rb(),u.vc(48,rt,18,19,"tr",24),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb(),u.Rb()}if(2&t){const t=u.oc(10),i=u.dc();u.Ab(7),u.jc("matDatepicker",t)("value",i.date),u.Ab(1),u.jc("for",t),u.Ab(9),u.yc(" ",i.metrics.tickets.length," "),u.Ab(6),u.yc(" ",i.metrics.total," "),u.Ab(6),u.yc(" ",i.metrics.avg," "),u.Ab(19),u.jc("ngForOf",i.metrics.tickets)}}const bt=[{path:"home",component:V},{path:"desktop",component:F},{path:"dashboard",component:(()=>{class t{constructor(t,i){this.metricService=t,this.loginService=i,this.loading=!1,this.metrics={total:0,avg:0,tickets:[]},this.date=new Date}ngOnInit(){let t=(new Date).setHours(0,0,0,0);this.getMetrics(t)}setDate(t){let i=+new Date(t.value);this.date=new Date(i),this.getMetrics(i)}getMetrics(t){this.loading=!0,this.metricService.getUserMetrics(t,this.loginService.user._id).subscribe(t=>{this.metrics=t.metrics,this.loading=!1},()=>{this.loading=!1})}}return t.\u0275fac=function(i){return new(i||t)(u.Mb(tt),u.Mb(v.a))},t.\u0275cmp=u.Gb({type:t,selectors:[["app-dashboard"]],decls:2,vars:2,consts:[["class","mt-5 animated fadeIn",4,"ngIf"],[4,"ngIf"],[1,"mt-5","animated","fadeIn"],[1,"saturno-container"],[1,"row"],[1,"col","w-100"],["appearance","fill",1,"w-100"],["matInput","",3,"matDatepicker","value","dateChange"],["matSuffix","",3,"for"],["picker1",""],[1,"row","mb-4"],[1,"col"],[1,"card","text-white","bg-success"],[1,"card-header"],[1,"card-body","saturno-container-mini-body"],[1,"card","text-white","bg-danger"],[1,"card","text-white","bg-primary"],[1,"card","bg-secondary","mb-4"],[1,"card-content","table-responsive-sm","p-2"],[1,"table","table-sm","text-white","text-center",2,"font-size","x-small"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[2,"text-align","center","border","none"],[2,"text-align","right","border","none"],[4,"ngFor","ngForOf"],[2,"text-align","left"],[2,"text-align","center"],[2,"text-align","right"]],template:function(t,i){1&t&&(u.vc(0,ot,2,0,"div",0),u.vc(1,dt,49,7,"div",1)),2&t&&(u.jc("ngIf",i.loading),u.Ab(1),u.jc("ngIf",!i.loading))},directives:[s.j,p.b,N.c,N.f,it.b,et.b,et.d,N.g,et.a,s.i],pipes:[ct,at],styles:[""]}),t})()},{path:"",redirectTo:"/assistant/home",pathMatch:"full"},{path:"**",component:O.a}];let lt=(()=>{class t{}return t.\u0275mod=u.Kb({type:t}),t.\u0275inj=u.Jb({factory:function(i){return new(i||t)},imports:[[n.e.forChild(bt)],n.e]}),t})();var ut=e("1+r1"),vt=e("iTUp");let ht=(()=>{class t{}return t.\u0275mod=u.Kb({type:t}),t.\u0275inj=u.Jb({factory:function(i){return new(i||t)},imports:[[k.i,s.b,ut.a,vt.a,lt]]}),t})()}}]);
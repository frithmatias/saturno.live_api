(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{w8Di:function(t,e,i){"use strict";i.r(e),i.d(e,"AssistantModule",(function(){return E}));var s=i("SVse"),n=i("iInd"),c=i("HDdC"),r=i("D0XW"),o=i("Y7HM");function a(t=0,e=r.a){return(!Object(o.a)(t)||t<0)&&(t=0),e&&"function"==typeof e.schedule||(e=r.a),new c.a(i=>(i.add(e.schedule(b,t,{subscriber:i,counter:0,period:t})),i))}function b(t){const{subscriber:e,counter:i,period:s}=t;e.next(i),this.schedule({subscriber:e,counter:i+1,period:s},s)}var l=i("lJxs"),d=i("IzEk"),u=i("vkgz"),k=i("1G5W"),h=i("8Y7J"),p=i("TGE+"),v=i("qfBg"),m=i("Gyf/"),g=i("zHaW"),f=i("Tj54");function P(t,e){1&t&&(h.Qb(0,"span"),h.Qb(1,"mat-icon",25),h.rc(2,"directions_walk"),h.Pb(),h.Pb())}function Q(t,e){if(1&t&&(h.Qb(0,"div"),h.Qb(1,"div",26),h.Qb(2,"div",27),h.rc(3," Atendiendo turno "),h.Pb(),h.Pb(),h.Qb(4,"div",26),h.Qb(5,"div",28),h.rc(6),h.Pb(),h.Pb(),h.Pb()),2&t){const t=h.Zb();h.zb(6),h.uc(" ",t.ticketsService.myTicket.cd_skill," ",t.ticketsService.myTicket.id_ticket," ")}}function S(t,e){if(1&t&&(h.Qb(0,"div",29),h.rc(1),h.Pb()),2&t){const t=h.Zb();h.zb(1),h.sc(t.message)}}function y(t,e){if(1&t&&(h.Qb(0,"tr"),h.Qb(1,"td",30),h.rc(2),h.Pb(),h.Qb(3,"td",31),h.rc(4),h.Pb(),h.Pb()),2&t){const t=e.$implicit;h.zb(2),h.tc(" ",t.tx_skill," "),h.zb(2),h.tc(" ",t.tickets.length," ")}}let w=(()=>{class t{constructor(t,e,i,s,n){this.activatedRoute=t,this.ticketsService=e,this.userService=i,this.wsService=s,this.snack=n,this.waitForClient=!1,this.comingClient=!1,this.pendingTicketsCount=0,this.pendingTicketsBySkill=[],this.timerCount=10,this.tmWaiting="--:--:--",this.tmAttention="--:--:--",this.activatedRoute.params.subscribe(t=>{t.id&&(this.cdDesk=t.id)})}ngOnInit(){this.getTickets(),this.wsService.escucharTurnos().subscribe(t=>{this.getTickets()})}getTickets(){return t=this,void 0,i=function*(){const t=yield this.ticketsService.getTickets(),e=t.filter(t=>t.cd_desk===this.cdDesk&&null===t.tm_end)[0];e&&(this.message="Existe un ticket pendiente de resoluci\xf3n",this.snack.open("Existe un ticket pendiente",null,{duration:2e3}),localStorage.setItem("ticket",JSON.stringify(e)));const i=t.filter(t=>null===t.tm_end);this.pendingTicketsCount=i.length,i.length>0&&(this.message=`Hay ${i.length} tickets en espera`);const s=this.userService.usuario.id_skills;this.pendingTicketsBySkill=[];for(let n of s)this.pendingTicketsBySkill.push({cd_skill:n.cd_skill,tx_skill:n.tx_skill,tickets:i.filter(t=>t.id_skill===n._id&&null===t.tm_end)})},new((e=void 0)||(e=Promise))((function(s,n){function c(t){try{o(i.next(t))}catch(e){n(e)}}function r(t){try{o(i.throw(t))}catch(e){n(e)}}function o(t){var i;t.done?s(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(c,r)}o((i=i.apply(t,[])).next())}));var t,e,i}atenderTicket(){this.ticketsService.atenderTicket(this.cdDesk,this.userService.desktop._id,this.userService.usuario._id,this.wsService.idSocket).subscribe(t=>{if(this.snack.open(t.msg,null,{duration:2e3}),t.ok){this.waitForClient=!0,this.message="",this.ticketsService.myTicket=t.ticket,localStorage.setItem("ticket",JSON.stringify(t.ticket)),this.tmWaiting=this.ticketsService.getTimeInterval(t.ticket.tm_start,t.ticket.tm_att);const e=this.wsService.escucharEnCamino(),i=a(1e3).pipe(Object(l.a)(t=>t+1),Object(d.a)(10));let s=!1;i.pipe(Object(u.a)(t=>this.timerCount=10-t),Object(k.a)(e)).subscribe(t=>{t>=9&&(s=!0)},void 0,()=>{new Promise(t=>{s?(this.waitForClient=!1,this.comingClient=!1,t()):(this.waitForClient=!0,this.comingClient=!0,a(1e3).pipe(Object(l.a)(t=>t+1),Object(d.a)(20)).subscribe(t=>this.timerCount=20-t,void 0,()=>{this.waitForClient=!1,this.comingClient=!1,t()}))}).then(()=>{const t=a(1e3),e=(new Date).getTime(),i=t.subscribe(()=>{this.ticketsService.myTicket?this.tmAttention=this.ticketsService.getTimeInterval(e,+new Date):i.unsubscribe()})})})}else this.waitForClient=!1,this.message=t.msg,this.clearSession()}),this.getTickets()}atenderInformes(){}devolverTicket(){this.clearSession(),this.ticketsService.devolverTicket(this.cdDesk).subscribe(t=>{this.message=t.msg})}finalizarTicket(){this.clearSession(),this.ticketsService.finalizarTicket(this.cdDesk).subscribe(t=>{this.message=t.msg})}clearSession(){this.ticketsService.myTicket=null,localStorage.getItem("ticket")&&localStorage.removeItem("ticket"),this.ticketsService.chatMessages=[],this.tmWaiting="--:--:--",this.tmAttention="--:--:--"}}return t.\u0275fac=function(e){return new(e||t)(h.Lb(n.a),h.Lb(p.a),h.Lb(v.a),h.Lb(m.a),h.Lb(g.a))},t.\u0275cmp=h.Fb({type:t,selectors:[["app-desktop"]],decls:57,vars:13,consts:[[1,"m-4","row","animated","fadeIn"],[1,"col-lg-6"],[1,"card","bg-light","mb-4"],[1,"card-header","banner-title"],[4,"ngIf"],[1,"banner-content"],[1,"container"],["class","card text-white my-4 p-2","style","background-color: darkcyan;",4,"ngIf"],[1,"row","banner-footer"],[1,"col","p-0"],[1,"content"],[1,"my-1"],[1,"row",2,"justify-content","space-between"],[1,"col","col-6","col-md-3","p-1"],[1,"btn","btn-block","btn-danger",3,"disabled","click"],[1,"btn","btn-block","btn-info",3,"disabled","click"],[1,"btn","btn-block","btn-primary",3,"disabled","click"],[1,"btn","btn-block","btn-success",3,"disabled","click"],[1,"card","bg-primary","mb-4"],[1,"card-content","table-responsive-sm","p-2"],[1,"table","table-sm","text-white","text-center",2,"font-size","large"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[2,"text-align","center","border","none"],[4,"ngFor","ngForOf"],[2,"float","right","color","blueviolet","font-size","x-large"],[1,"row"],[1,"col"],[1,"col","xxxxl"],[1,"card","text-white","my-4","p-2",2,"background-color","darkcyan"],[2,"text-align","left"],[2,"text-align","center"]],template:function(t,e){1&t&&(h.Qb(0,"div",0),h.Qb(1,"div",1),h.Qb(2,"div",2),h.Qb(3,"div",3),h.Qb(4,"span"),h.rc(5),h.Pb(),h.qc(6,P,3,0,"span",4),h.Pb(),h.Qb(7,"div",5),h.Qb(8,"div",6),h.qc(9,Q,7,2,"div",4),h.qc(10,S,2,1,"div",7),h.Qb(11,"div",8),h.Qb(12,"div",9),h.Qb(13,"div"),h.rc(14,"TE"),h.Pb(),h.Qb(15,"div"),h.rc(16),h.Pb(),h.Pb(),h.Qb(17,"div",9),h.Qb(18,"div"),h.rc(19,"TA"),h.Pb(),h.Qb(20,"div"),h.rc(21),h.Pb(),h.Pb(),h.Qb(22,"div",9),h.Qb(23,"div"),h.rc(24,"Tm"),h.Pb(),h.Qb(25,"div"),h.rc(26),h.Pb(),h.Pb(),h.Qb(27,"div",9),h.Qb(28,"div"),h.rc(29,"TC"),h.Pb(),h.Qb(30,"div"),h.rc(31),h.Pb(),h.Pb(),h.Pb(),h.Qb(32,"div",10),h.Mb(33,"hr",11),h.Qb(34,"div",12),h.Qb(35,"div",13),h.Qb(36,"button",14),h.Xb("click",(function(){return e.devolverTicket()})),h.rc(37," Devolver "),h.Pb(),h.Pb(),h.Qb(38,"div",13),h.Qb(39,"button",15),h.Xb("click",(function(){return e.atenderInformes()})),h.rc(40," Informes "),h.Pb(),h.Pb(),h.Qb(41,"div",13),h.Qb(42,"button",16),h.Xb("click",(function(){return e.finalizarTicket()})),h.rc(43," Finalizar "),h.Pb(),h.Pb(),h.Qb(44,"div",13),h.Qb(45,"button",17),h.Xb("click",(function(){return e.atenderTicket()})),h.rc(46," Siguiente "),h.Pb(),h.Pb(),h.Pb(),h.Pb(),h.Pb(),h.Pb(),h.Pb(),h.Pb(),h.Qb(47,"div",1),h.Qb(48,"div",18),h.Qb(49,"div",19),h.Qb(50,"table",20),h.Qb(51,"tr",21),h.Qb(52,"td",22),h.rc(53," Skill "),h.Pb(),h.Qb(54,"td",23),h.rc(55," Cola "),h.Pb(),h.Pb(),h.qc(56,y,5,2,"tr",24),h.Pb(),h.Pb(),h.Pb(),h.Pb(),h.Pb()),2&t&&(h.zb(5),h.tc(" ESCRITORIO ",e.cdDesk," "),h.zb(1),h.ec("ngIf",e.comingClient),h.zb(3),h.ec("ngIf",e.ticketsService.myTicket),h.zb(1),h.ec("ngIf",e.message),h.zb(6),h.sc(e.tmWaiting),h.zb(5),h.sc(e.tmAttention),h.zb(5),h.sc(e.timerCount),h.zb(5),h.sc(e.pendingTicketsCount),h.zb(5),h.ec("disabled",e.waitForClient),h.zb(3),h.ec("disabled",e.waitForClient),h.zb(3),h.ec("disabled",e.waitForClient),h.zb(3),h.ec("disabled",e.waitForClient),h.zb(11),h.ec("ngForOf",e.pendingTicketsBySkill))},directives:[s.j,s.i,f.a],styles:[".desktop-panel-buttons[_ngcontent-%COMP%]{font-size:1.5rem;position:relative;top:-.3rem;left:-.3rem}"]}),t})();var T=i("AIE+"),z=i("Q2Ze"),I=i("ZTz/"),_=i("UhP/");function C(t,e){if(1&t&&(h.Qb(0,"mat-option",13),h.rc(1),h.Pb()),2&t){const t=e.$implicit;h.ec("value",t),h.zb(1),h.tc("",t.cd_desktop," ")}}function D(t,e){if(1&t){const t=h.Rb();h.Qb(0,"div",6),h.Qb(1,"mat-form-field",8),h.Qb(2,"mat-label"),h.rc(3,"Seleccione"),h.Pb(),h.Qb(4,"mat-select",9,10),h.qc(6,C,2,2,"mat-option",11),h.Pb(),h.Pb(),h.Qb(7,"div"),h.Qb(8,"button",12),h.Xb("click",(function(){h.kc(t);const e=h.jc(5);return h.Zb().entrar(null==e?null:e.value)})),h.rc(9,"Ingresar"),h.Pb(),h.Pb(),h.Pb()}if(2&t){const t=h.Zb();h.zb(6),h.ec("ngForOf",t.desktopsAvailable)}}function x(t,e){if(1&t){const t=h.Rb();h.Qb(0,"div",6),h.rc(1),h.Qb(2,"div"),h.Qb(3,"button",14),h.Xb("click",(function(){h.kc(t);const e=h.Zb();return e.entrar(e.myDesktop)})),h.rc(4,"Ingresar"),h.Pb(),h.Qb(5,"button",15),h.Xb("click",(function(){h.kc(t);const e=h.Zb();return e.finalizar(e.myDesktop)})),h.rc(6,"Finalizar"),h.Pb(),h.Pb(),h.Pb()}if(2&t){const t=h.Zb();h.zb(1),h.tc(" Usted tiene tomado el escritorio ",t.myDesktop.cd_desktop," ")}}function F(t,e){if(1&t&&(h.Qb(0,"div"),h.rc(1),h.Pb()),2&t){const t=e.$implicit;h.zb(1),h.uc(" ",t.cd_desktop," tomado por ",t.id_assistant," ")}}function O(t,e){if(1&t&&(h.Qb(0,"div",6),h.rc(1," Todos los escritorios estan tomados. "),h.qc(2,F,2,2,"div",16),h.Pb()),2&t){const t=h.Zb();h.zb(2),h.ec("ngForOf",t.desktops)}}const j=[{path:"home",component:(()=>{class t{constructor(t,e,i){this.router=t,this.userService=e,this.snack=i,this.desktops=[],this.desktopsAvailable=[]}ngOnInit(){this.obtenerEscritorios()}entrar(t){t&&this.userService.takeDesktop(this.userService.usuario.id_company._id,t._id,this.userService.usuario._id).subscribe(e=>{this.snack.open(e.msg,null,{duration:2e3}),e.ok?(this.userService.desktop=e.desktop,localStorage.setItem("desktop",JSON.stringify(e.desktop)),this.router.navigate(["/assistant/desktop",t.cd_desktop])):this.snack.open("No se pudo tomar un escritorio",null,{duration:2e3})})}obtenerEscritorios(){this.userService.readDesktops(this.userService.usuario.id_company._id).subscribe(t=>{this.desktops=t.desktops,this.desktopsAvailable=this.desktops.filter(t=>null===t.id_assistant),this.myDesktop=this.desktops.filter(t=>t.id_assistant===this.userService.usuario._id)[0],this.myDesktop?(this.userService.desktop=this.myDesktop,localStorage.setItem("desktop",JSON.stringify(this.myDesktop))):(this.userService.desktop=null,localStorage.getItem("desktop")&&localStorage.removeItem("desktop"))})}finalizar(t){this.userService.releaseDesktop(t).subscribe(t=>{this.obtenerEscritorios()})}}return t.\u0275fac=function(e){return new(e||t)(h.Lb(n.b),h.Lb(v.a),h.Lb(g.a))},t.\u0275cmp=h.Fb({type:t,selectors:[["app-home"]],decls:15,vars:3,consts:[[1,"turno-container","p-4",2,"text-align","-webkit-center"],[1,"card","bg-light","mb-3",2,"min-width","18rem","max-width","30rem"],[1,"jumbotron","m-4","animated","fadeIn"],[1,"display-4"],[1,"lead"],["class","my-4",4,"ngIf"],[1,"my-4"],["routerLink","/assistant/dashboard","role","button",1,"btn","btn-primary","btn-lg","btn-block"],["appearance","fill"],["matNativeControl","","required",""],["selectDesktop",""],[3,"value",4,"ngFor","ngForOf"],["role","button",1,"btn","btn-success","btn-lg","btn-block",3,"click"],[3,"value"],["role","button",1,"btn","btn-success","btn-lg","m-1",3,"click"],["role","button",1,"btn","btn-danger","btn-lg","m-1",3,"click"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(h.Qb(0,"div",0),h.Qb(1,"div",1),h.Qb(2,"div",2),h.Qb(3,"h1",3),h.rc(4,"Bienvenido a la web del asistente"),h.Pb(),h.Qb(5,"p",4),h.rc(6,"Bienvenido, desde aqu\xed puede sacar un turno y evitar la sala de esperas."),h.Pb(),h.qc(7,D,10,1,"div",5),h.qc(8,x,7,1,"div",5),h.qc(9,O,3,1,"div",5),h.Mb(10,"hr",6),h.Qb(11,"p"),h.rc(12," Desde ac\xe1 podes ingresar a una ventanilla de atenci\xf3n. Desde el chat podra ver las consultas de los clientes una vez se les haya asignado esta ventanilla. Si desea puede tambi\xe9n atender consultas desde la ventanilla de informes para todas las consultas que todav\xeda permanecen en espera. "),h.Pb(),h.Qb(13,"a",7),h.rc(14,"Dashboard"),h.Pb(),h.Pb(),h.Pb(),h.Pb()),2&t&&(h.zb(7),h.ec("ngIf",!e.myDesktop),h.zb(1),h.ec("ngIf",e.myDesktop),h.zb(1),h.ec("ngIf",0===e.desktopsAvailable.length))},directives:[s.j,n.d,z.b,z.e,I.a,s.i,_.h],styles:[""]}),t})()},{path:"desktop/:id",component:w},{path:"dashboard",component:(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=h.Fb({type:t,selectors:[["app-dashboard"]],decls:4,vars:0,consts:[[1,"container","animated","fadeIn"],[1,"row"],[1,"col"]],template:function(t,e){1&t&&(h.Qb(0,"div",0),h.Qb(1,"div",1),h.Qb(2,"div",2),h.rc(3," Dashboard "),h.Pb(),h.Pb(),h.Pb())},styles:[""]}),t})()},{path:"",redirectTo:"/assistant/home",pathMatch:"full"},{path:"**",component:T.a}];let q=(()=>{class t{}return t.\u0275mod=h.Jb({type:t}),t.\u0275inj=h.Ib({factory:function(e){return new(e||t)},imports:[[n.e.forChild(j)],n.e]}),t})();var A=i("1+r1");let E=(()=>{class t{}return t.\u0275mod=h.Jb({type:t}),t.\u0275inj=h.Ib({factory:function(e){return new(e||t)},imports:[[s.b,A.a,q]]}),t})()}}]);